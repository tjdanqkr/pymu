define(["require","exports","tslib","modules/clean/analytics","modules/clean/react/delorean/data/types","modules/clean/react/delorean/util","sjcl","modules/clean/filepath","modules/clean/react/trash/constants","modules/core/browser_detection"],(function(e,t,r,o,s,n,a,i,l,d){"use strict";var _,c;Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),i=r.__importStar(i),(function(e){e.load_callout="delorean_browse_load_callout",e.exit_callout="delorean_browse_exit_callout",e.load_preview="delorean_browse_load_preview",e.click_preview_cancel="delorean_browse_click_preview_cancel",e.click_preview_rb="delorean_browse_click_preview_rb",e.click_preview_back="delorean_browse_click_preview_back",e.click_help="delorean_browse_click_help",e.click_nux_next="delorean_browse_click_nux_next",e.load_day_graph="delorean_browse_load_day_graph",e.click_day_graph_date="delorean_browse_click_day_graph_date",e.click_day_graph_next="delorean_browse_click_day_graph_next",e.load_events="delorean_browse_load_events",e.click_events_back="delorean_browse_click_events_back",e.click_events_load_new="delorean_browse_click_events_load_new",e.click_events_load_old="delorean_browse_click_events_load_old",e.click_events_next="delorean_browse_click_events_next",e.load_progress="delorean_browse_load_progress",e.load_completion="delorean_browse_load_completion",e.exit_drawer="delorean_browse_exit_drawer",e.load_nux="delorean_browse_load_nux",e.load_upsell="delorean_browse_load_upsell",e.click_upsell="delorean_browse_click_upsell"})(_||(_={})),(function(e){e.click_close="click_close",e.page_exit="page_exit",e.browse_folder="browse_folder"})(t.DeloreanCloseReason||(t.DeloreanCloseReason={})),(function(e){e.nux="nux",e.day_graph="day_graph",e.events="events",e.preview="preview",e.progress="progress",e.completion="completion",e.upsell="upsell",e.error_1="error_1",e.error_2="error_2"})(c=t.DeloreanPage||(t.DeloreanPage={}));var p=function(e){return e.isInsideSharedFolder?"sf":e.isInsideTeamFolderTree?"team_space":"home_ns"};t.exitDrawer=function(e){var t,r=e.reason,a=e.activePage,i=e.allPageData,l=e.restoreId,d=e.user;a===s.RewindFlowPage.NUXPage?t=c.nux:a===s.RewindFlowPage.graphPage?t=c.day_graph:a===s.RewindFlowPage.activityListPage?t=c.events:a===s.RewindFlowPage.confirmationPage?t=c.preview:a===s.RewindFlowPage.startedPage?i.startedPage.rewindState===s.RewindState.InProgress?t=c.progress:i.startedPage.rewindState===s.RewindState.Done?t=c.completion:(t=c.error_1,n.assertNever(i.startedPage.rewindState)):a===s.RewindFlowPage.notVisible?t=c.error_2:a===s.RewindFlowPage.upsellPage?t=c.upsell:(t=c.error_1,n.assertNever(a)),o.RestorationStepsLogger.log_step({userId:d.id,restoreId:l,step:_.exit_drawer,extra:{exit_step:t,exit_reason:r}})},t.loadNUX=function(e){var t=e.browseContext,r=e.user,s=e.restoreId,n=e.clickBrowseButtonTimestampMs,l=e.fromDesktopClient,c=p(t),g=d.get_browser_info(),u=g.browser+" "+g.version;o.RestorationStepsLogger.log_step({userId:r.id,restoreId:s,step:_.load_nux,extra:{ns_id:String(t.currentNSID),tti:String(n?(new Date).getTime()-n:"?"),path_hash:a.codec.hex.fromBits(a.hash.sha256.hash(t.currentFQPath)),path_nested_levels:String(i.normalize(t.currentFQPath).split("/").length),location_type:c,browser:u,from_desktop_client:String(l),referrer:document.referrer}})},t.loadUpsell=function(e){var t=e.browseContext,r=e.user,s=e.restoreId,n=e.clickBrowseButtonTimestampMs,l=e.fromDesktopClient,c=p(t),g=d.get_browser_info(),u=g.browser+" "+g.version;o.RestorationStepsLogger.log_step({userId:r.id,restoreId:s,step:_.load_upsell,extra:{ns_id:String(t.currentNSID),tti:String((new Date).getTime()-n),path_hash:a.codec.hex.fromBits(a.hash.sha256.hash(t.currentFQPath)),path_nested_levels:String(i.normalize(t.currentFQPath).split("/").length),location_type:c,from_desktop_client:String(l),referrer:document.referrer,browser:u}})},t.clickUpsellHelp=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_help,extra:{help_step:c.upsell}})},t.clickUpsell=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_upsell})},t.loadCallout=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.load_callout})},t.exitCallout=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.exit_callout})},t.loadConfirmationPage=function(e){var t=e.eventCounts,r=e.graphPage,s=e.user,n=e.restoreId,a=e.eventToRewindTo,i=new Date;i.setHours(0,0,0,0),i.setDate(i.getDate()+1);var d=new Date(a.timestamp);d.setHours(0,0,0,0);var c=Math.abs((i.getTime()-d.getTime())/l.ONE_DAY_MS),p=t.slice().reverse().slice(0,c).reverse().reduce((function(e,t){return e+t.count}),0),g=void 0;"loaded"===r.contents.type&&(g=r.contents.changedNamespaceCount),o.RestorationStepsLogger.log_step({userId:s.id,restoreId:n,step:_.load_preview,extra:{tti:String(0),rb_time_interval:String(Date.now()-a.timestamp),sfj_count:String(p),num_ns_included:String(g)}})},t.clickPreviewCancel=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_preview_cancel})},t.clickPreviewId=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_preview_rb})},t.clickPreviewBack=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_preview_back})},t.clickPreviewHelp=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_help,extra:{help_step:c.preview}})},t.loadDayGraph=function(e){var t=e.errorString,r=e.user,s=e.restoreId,n=e.startedLoadingTimestamp,a=e.namespaceCount,i={tti:String(Date.now()-n),num_ns_contained:String(a)};t&&(i.error=t),o.RestorationStepsLogger.log_step({userId:r.id,restoreId:s,step:_.load_day_graph,extra:i})},t.clickDayGraphDate=function(e){var t=e.user,r=e.restoreId,s=e.selectedDateTsInMs,n=new Date;n.setHours(0,0,0,0),o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_day_graph_date,extra:{days_ago:String(Math.round(Math.abs((new Date(s).getTime()-n.getTime())/l.ONE_DAY_MS)))}})},t.clickDayGraphNext=function(e){var t=e.user,r=e.restoreId,s=e.selectedDateTsInMs,n=new Date;n.setHours(0,0,0,0),o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_day_graph_next,extra:{days_ago:String(Math.round(Math.abs((new Date(s).getTime()-n.getTime())/l.ONE_DAY_MS)))}})},t.clickNUXHelp=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_help,extra:{help_step:c.nux}})},t.clickNUXNext=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_nux_next})},t.loadEvents=function(e){var t=e.user,r=e.restoreId,n=e.events,a=e.startLoadTsInMs,i=void 0;null!==a&&(i=Date.now()-a);var l=n.type===s.RewindEventState.hasContent?n.processedEvents.filter((function(e){return e.type===s.DeloreanEventType.event})).length:0;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.load_events,extra:{num_events:String(l),tti:String(i)}})},t.clickEventsBack=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_events_back})},t.clickEventsLoadNew=function(e){var t=e.user,r=e.restoreId,s=e.startTsInMs,n=e.count;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_events_load_new,extra:{tti:String(Date.now()-s),num_events:String(n)}})},t.clickEventsLoadOld=function(e){var t=e.user,r=e.restoreId,s=e.startTsInMs,n=e.count;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_events_load_old,extra:{tti:String(Date.now()-s),num_events:String(n)}})},t.clickEventsNext=function(e){var t=e.user,r=e.events,a=e.initialEventTimestamp,i=e.selectedEvent,l=e.restoreId,d=a,c=i.timestamp,p=n.findIndex(r,(function(e){return e.type===s.DeloreanEventType.event&&e.timestamp===d}))||0,g=n.findIndex(r,(function(e){return e.type===s.DeloreanEventType.event&&e.timestamp===c}))||0;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:l,step:_.click_events_next,extra:{num_events_offset:String(Math.abs(p-g))}})},t.loadProgress=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.load_progress,extra:{tti:String(0)}})},t.loadCompletionSuccess=function(e){var t=e.user,r=e.restoreId,s=e.startTs;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.load_completion,extra:{time_to_completion:String(Date.now()-s),success:String(!0)}})},t.loadCompletionFailure=function(e){var t=e.user,r=e.restoreId,s=e.startTs;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.load_completion,extra:{time_to_completion:String(Date.now()-s),success:String(!1)}})},t.clickHelp=function(e){var t=e.user,r=e.restoreId,s=e.helpStep;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:_.click_help,extra:{help_step:s}})},t.openActivityList=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:"user opened timeline, office only"})},t.clickOnActivityList=function(e){var t=e.user,r=e.restoreId;o.RestorationStepsLogger.log_step({userId:t.id,restoreId:r,step:"user clicked folder history event, office only"})}}));
//# sourceMappingURL=logging.min.js-vfleSu29_.map