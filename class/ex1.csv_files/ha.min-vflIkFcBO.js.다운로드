define(["require","exports","tslib","jquery","classnames","external/lodash","react","react-dom","modules/clean/react/prompt/legacy_ha_wrapper","modules/clean/react/css","modules/clean/react/sprite","modules/clean/upsell/prompt_event_emitter","modules/clean/react/prompt/button","modules/clean/react/prompt/prompt_location","modules/core/i18n","modules/clean/react/maestro_nav/experiments/suggest_member_button"],(function(t,e,n,o,i,s,r,a,l,h,p,u,m,f,c,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o=n.__importDefault(o),i=n.__importDefault(i),s=n.__importStar(s),r=n.__importDefault(r),a=n.__importStar(a);var g;(function(t){t[t.HIDE=1]="HIDE",t[t.SHOW=2]="SHOW"})(g=e.ShowState||(e.ShowState={})),e.UPDATE_STATE_PERIODIC_INTERVAL=1e3;var S=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.renderText=function(){var t=this.props.content;return r.default.createElement("p",{className:"confirm-button--text-container"},r.default.createElement(m.ConfirmButton,{className:"confirm-button--text",confirmInNewTab:t.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,html:t.text,onConfirm:this.props.onConfirm}))},e.prototype.renderConfirmButton=function(){var t=this.props.content;return t.confirmText?r.default.createElement(m.ConfirmButton,{className:"button",confirmInNewTab:t.confirmInNewTab,confirmIsPost:this.props.confirmIsPost,confirmUrl:this.props.confirmUrl,html:t.confirmText,onConfirm:this.props.onConfirm}):null},e.prototype.renderDismissButton=function(){return r.default.createElement(m.DismissButton,{onDismiss:this.props.onDismiss,"aria-label":c._("Close")},r.default.createElement(p.Sprite,{group:"web",name:"close_small",alt:c._("Close")}))},e.prototype.render=function(){var t=this.props.isDismissed,e=i.default({ha:!0,visible:!t&&this.props.showState===g.SHOW,hidden:!t&&this.props.showState===g.HIDE,invisible:this.props.isInvisible});return r.default.createElement("div",{className:e,role:"dialog"},this.renderText(),this.renderConfirmButton(),this.renderDismissButton())},e.displayName="HARendererWithoutCSS",e})(r.default.Component);e.HARendererWithoutCSS=S,e.HARendererWithCSS=h.requireCssWithComponent(S,["/static/css/upsell/prompt_pagelet-vflPzbv-y.css"]);var _=(function(t){function i(e){var n=t.call(this,e,{cloneShowState:g.SHOW,isConfirmed:!1,isDismissed:!1,isShown:!1,showState:g.HIDE,topOffsetToFit:0})||this;return n.setHaRef=function(t){n.ha=t},n.setHaCloneRef=function(t){n.haClone=t},n.onPageUpdate=n.onPageUpdate.bind(n),n}return n.__extends(i,t),i.prototype.componentDidMount=function(){this.onUpdate(),o.default(window).resize(this.onPageUpdate),u.eventEmitter.addListener(u.Events.REACT_HA_DID_UPDATE,this.onPageUpdate),this.intervalID=setInterval(this.onPageUpdate,e.UPDATE_STATE_PERIODIC_INTERVAL)},i.prototype.componentWillUnmount=function(){o.default(window).off("resize",this.onPageUpdate),u.eventEmitter.off(u.Events.REACT_HA_DID_UPDATE,this.onPageUpdate),clearInterval(this.intervalID)},i.prototype.componentDidUpdate=function(){this.onUpdate()},i.prototype.onPageUpdate=function(){this.setState((function(t){return t.cloneShowState=g.SHOW,t}))},i.prototype.onUpdate=function(){var t=this;this.state.cloneShowState>g.HIDE&&this.canFit()?this.state.showState!==this.state.cloneShowState&&this.setState((function(t){return t.showState=t.cloneShowState,t}),(function(){t.state_manager.onShow()})):this.state.showState!==g.HIDE&&this.setState((function(t){return t.showState=g.HIDE,t}))},i.prototype.render=function(){return r.default.createElement("div",null,r.default.createElement(e.HARendererWithCSS,{isInvisible:!1,content:this.props.campaign.content,confirmUrl:this.state_manager.buildConfirmEndpointURI(),confirmIsPost:this.state_manager.shouldConfirmUsingPost(),isDismissed:this.state.isDismissed,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,ref:this.setHaRef,showState:this.state.showState}),r.default.createElement(e.HARendererWithCSS,{isInvisible:!0,content:this.props.campaign.content,confirmUrl:this.state_manager.buildConfirmEndpointURI(),confirmIsPost:this.state_manager.shouldConfirmUsingPost(),isDismissed:this.state.isDismissed,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,ref:this.setHaCloneRef,showState:this.state.cloneShowState}))},i.prototype.canFit=function(){var t=this.getMenuHeight();if(null===t)return!1;var e=this.getHAHeight();return null!==e&&t+e<=this.getWindowHeight()},i.prototype.getHAHeight=function(){var t=o.default(a.findDOMNode(this.haClone));if(0===t.length)return null;return t.outerHeight()+75},i.prototype.getMenuHeight=function(){var t=o.default(".maestro-secondary-sidebar, .appactions-menu").first();if(0===t.length)return null;var e=t.children(),n=t.offset().top-o.default(document).scrollTop();return e.each((function(t,e){n+=o.default(e).outerHeight(!0)})),n},i.prototype.getWindowHeight=function(){return o.default(window).height()},i})(f.PromptLocation);e.HA=_;var D=(function(t){function i(e){var n=t.call(this,e,{cloneShowState:g.SHOW,isConfirmed:!1,isDismissed:!1,isShown:!1,showState:g.HIDE,topOffsetToFit:0})||this;return n.onWindowResize=s.debounce((function(){n.onPageUpdate()}),250),n.setHaRef=function(t){n.ha=t},n.setHaCloneRef=function(t){n.haClone=t},n.onPageUpdate=n.onPageUpdate.bind(n),n}return n.__extends(i,t),i.prototype.componentDidMount=function(){this.onUpdate(),window.addEventListener("resize",this.onWindowResize),this.intervalID=setInterval(this.onPageUpdate,e.UPDATE_STATE_PERIODIC_INTERVAL)},i.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.onWindowResize),clearInterval(this.intervalID)},i.prototype.componentDidUpdate=function(){this.onUpdate()},i.prototype.onPageUpdate=function(){this.setState({cloneShowState:g.SHOW})},i.prototype.onUpdate=function(){var t,e=this;this.state.cloneShowState>g.HIDE&&(t=this.getTopOffsetToFit())>-1?this.state.showState===this.state.cloneShowState&&this.state.topOffsetToFit===t||this.setState({showState:this.state.cloneShowState,topOffsetToFit:t},(function(){e.state_manager.onShow()})):this.state.showState!==g.HIDE&&this.setState({showState:g.HIDE})},i.prototype.render=function(){return 2378===this.props.campaign.campaignId?r.default.createElement("div",{"data-testid":"suggest_member_button_container"},r.default.createElement(d.SuggestMemberButton,null)):r.default.createElement("div",{className:"inline-ha-wrapper",style:{top:this.state.topOffsetToFit}},r.default.createElement(e.HARendererWithCSS,{isInvisible:!1,content:this.props.campaign.content,confirmUrl:this.state_manager.buildConfirmEndpointURI(),confirmIsPost:this.state_manager.shouldConfirmUsingPost(),isDismissed:this.state.isDismissed,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,ref:this.setHaRef,showState:this.state.showState}),r.default.createElement(e.HARendererWithCSS,{isInvisible:!0,content:this.props.campaign.content,confirmUrl:this.state_manager.buildConfirmEndpointURI(),confirmIsPost:this.state_manager.shouldConfirmUsingPost(),isDismissed:this.state.isDismissed,onConfirm:this.state_manager.onConfirm,onDismiss:this.state_manager.onDismiss,ref:this.setHaCloneRef,showState:this.state.cloneShowState}))},i.prototype.getTopOffsetToFit=function(){var t=this.getHAHeight();if(null===t)return-1;var e=this.getMenuHeight();if(null===e)return-1;var n=this.getWindowHeight();return n<=t+e?-1:n-t},i.prototype.getHAHeight=function(){var t=o.default(a.findDOMNode(this.haClone));return 0===t.length?null:t.outerHeight(!0)},i.prototype.getMenuHeight=function(){var t=o.default(".maestro-nav__features, .maestro-nav__products").first();return 0===t.length?null:t.height()},i.prototype.getWindowHeight=function(){return o.default(".maestro-nav__panel").height()-80},i})(f.PromptLocation);e.InlineHA=D;var w=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n.__extends(e,t),e.prototype.render=function(){return this.props.campaign.delegateRendering?(u.promptBufferedEventEmitter.emit(u.Events.ON_HA_LOADED,this.props),null):r.default.createElement(_,n.__assign({},this.props))},e})(f.PromptLocation);e.DelegatingHARenderer=w,e.MaestroHA=function(t){return t.haProps?r.default.createElement(D,n.__assign({},t.haProps)):r.default.createElement(l.LegacyHAWrapper,null)}}));
//# sourceMappingURL=ha.min.js-vflJM94Xa.map