define(["require","exports","tslib","react","modules/clean/ajax","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/file_actions/file_action_helpers","modules/clean/react/extensions/data/types","modules/clean/react/extensions/split_share_button_component","modules/clean/react/extensions/utils","modules/clean/react/file_viewer/async_controller","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/uri","modules/clean/react/files_view/files_view_logging"],(function(e,r,t,i,o,n,a,s,c,l,u,S,_,d,f,h,m,p,E,g,b,A){"use strict";function w(e,r){var t=r.user,i=r.context,a=r.firstFile,u=r.isSearchMode,S=r.useSearchSuccessBanner,_=r.expBrowseSuccessBanner,d=r.isSidebar?m.ActionSurfaceLogValue.RIGHT_SIDEBAR:m.ActionSurfaceLogValue.CENTER_PANE;if(e.skipLogging||A.logEventWithNumberOfFiles({file:a,user:t,isSearchMode:u,action:m.WebUserActionLogEvent.SHARE,action_source:e.action_source,action_surface:d,extra:e.extra}),l.showRetrievalSuccessBanner(S,u,_,m.WebUserActionLogEvent.SHARE),e.autoShareLink){var p=new b.URI({path:"/sm/create"+n.normalize(a.fq_path)});p.updateQuery("_subject_uid",t.id.toString()),p.updateQuery("redirect","0");o.WebRequest({url:p.toString(),type:"POST",success:function(e){E.redirect(e)}})}else f.asyncShowShareModal(t,a,{browseContext:i,origin:h.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},(function(e){var r=e.path,t=e.qargs;return c.getStoreForBrowse().dispatch(s.setUrl({path:r,qargs:t}))}))}Object.defineProperty(r,"__esModule",{value:!0}),i=t.__importDefault(i),o=t.__importStar(o),n=t.__importStar(n),E=t.__importStar(E);var v=function(r){var i=r.isSidebar?m.ActionSourceValue.SHARE:m.ActionSourceValue.OVERFLOW_MENU;return function(){return t.__awaiter(void 0,void 0,void 0,(function(){var o,n,a;return t.__generator(this,(function(s){switch(s.label){case 0:return w({autoShareLink:!1,action_source:i},r),r.isSidebar?[4,new Promise((function(r,t){e(["modules/clean/react/app_actions/telemetry_client"],r,t)})).then(t.__importStar)]:[2];case 1:return o=s.sent(),n=o.createTelemetryClient,a=o.getPiiSafeExtension,n({component:"share-btn"}).session({surface:r.isSearchMode?"search":"browse",ext:a(r.firstFile.ext)}).event("click_share",{trigger_type:u.TriggerType.SidebarPrimaryButton}),[2]}}))}))}},R=function(e){return function(r){var t=e.isSidebar?m.ActionSurfaceLogValue.RIGHT_SIDEBAR:m.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({result:e.firstFile,args:e,action_type:m.WebUserActionLogEvent.SHARE,action_source:m.ActionSourceValue.SPLIT_SHARE,action_surface:t,extra:{splitshare_option:r}})}},V=function(e){return function(){var r=e.isSidebar?m.ActionSurfaceLogValue.RIGHT_SIDEBAR:m.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({result:e.firstFile,args:e,action_type:m.WebUserActionLogEvent.OPEN_SPLITSHARE,action_source:m.ActionSourceValue.SPLIT_SHARE,action_surface:r})}},y=function(e){return function(){d.asyncOpenPreview({containerId:a.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e.firstFile],indexOfPreviewFile:0,shouldFocusComment:!1,user:e.user,onFileViewerDidMount:d.hideElementsBehindFileViewer,onFileViewerUnmount:d.showElementsBehindFileViewer,fileViewAction:p.FileViewActionType.CLICK,fileViewOrigin:p.FileViewOriginType.BROWSE,fileViewTarget:p.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}};r.getShareItem=function(e,r){var t,o=r.shareItemDisabled,n=r.firstFile,a=r.user,s=r.isSidebar,c=r.isSearchMode,l=r.isViewSmall,d=r.showSplitShare,f=r.isCreateButtonMoveEnabled,h=r.forceSplitShareSecondary,p=r.extensionsFeatureFlags,E=r.sharingServiceInfo,b=r.scrollableSidebarRef,A=r.shouldUsePortalPopover;return s&&!c&&!l&&d&&p&&E&&_.shouldShowSplitShare(p,E,n)?function(){return i.default.createElement(S.SplitShareButton,{file:n,user:a,variant:f&&h?"secondary":"primary",triggerType:u.TriggerType.SidebarPrimaryButton,onShowShare:(r=e,function(){w({autoShareLink:!1,action_source:m.ActionSourceValue.SPLIT_SHARE,skipLogging:!0},r)}),onDropdownOpen:V(e),logShareButtonClick:R(e),onPresentInZoom:y(e),context:{surface:c?"search":"browse"},scrollableSidebarRef:b,shouldUsePortalPopover:A});var r}:l?{label:g._("Share link"),performAction:(t=e,function(){w({autoShareLink:!1,action_source:t.isSidebar?m.ActionSourceValue.SHARE:m.ActionSourceValue.OVERFLOW_MENU},t)}),disabled:o,className:"action-share-link",iconName:"link",key:"share-link"}:{label:g._("Share"),iconName:"link",performAction:v(e),disabled:o,className:"action-share",key:"share"}}}));
//# sourceMappingURL=share.min.js-vfl6UHdH9.map