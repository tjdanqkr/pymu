define(["require","exports","tslib","modules/clean/teams/constants","modules/clean/teams/modals/delete_user_modal","modules/clean/teams/modals/edit_space_limit_modal","modules/clean/teams/modals/recover_user_modal","modules/clean/teams/modals/suspend_user_modal","modules/clean/teams/modals/unsuspend_user_modal","modules/clean/teams/admin/widgets/resend_invite_modal/resend_invite_modal","modules/clean/teams/admin/widgets/reset_2fa_modal/reset_2fa_modal","modules/clean/teams/modals/team_assume_user_modal","modules/clean/undo","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/clean/deferred_loader","modules/clean/teams/admin/widgets/reset_password_modal/reset_password_modal","modules/clean/teams/admin/widgets/admin_permissions_modal/admin_permissions_modal","modules/clean/teams/modals/team_admin_roles_modal","modules/clean/teams/admin/pages/activity/report/member_report_modal","modules/clean/teams/admin/maestro/admin_console_constants","modules/clean/teams/member_unlock_action"],(function(e,t,i,s,r,a,o,n,p,m,l,d,c,u,h,S,f,_,N,g,I,U,y,A){"use strict";var C,b;function D(e,t){null!=t&&e.push(t)}Object.defineProperty(t,"__esModule",{value:!0}),c=i.__importStar(c),h=i.__importStar(h),(function(e){e[e.ACTIVE=1]="ACTIVE",e[e.PENDING=2]="PENDING",e[e.ERROR=3]="ERROR",e[e.REMOVED=4]="REMOVED",e[e.SUSPENDED=5]="SUSPENDED"})(C=t.JoinState||(t.JoinState={})),(function(e){e[e.STATUS_INACTIVE=0]="STATUS_INACTIVE",e[e.STATUS_ACTIVE=1]="STATUS_ACTIVE",e[e.STATUS_OPTIONAL=2]="STATUS_OPTIONAL"})(b||(b={}));var R=(function(){function e(){this.disabled=!1}return e.prototype.getItem=function(){return this.isValid?this.iconName?{actionId:this.actionId,displayName:this.actionDisplayName,handleClick:this.callbackAction,disabled:this.disabled,iconName:this.iconName,groupName:this.groupName}:{displayName:this.actionDisplayName,handleClick:this.callbackAction,disabled:this.disabled,spriteName:this.spriteName}:null},e})(),v=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Sign in as user",{project:"maestro",comment:'Button in right panel of indiv member page. Long languages: plz shorten to translation of "sign in"'}),i.iconName="sign-in-as-user",i.isValid=t.canAssumeUser,i.callbackAction=function(){return d.showTeamAssumeUserModal({userId:t.userId,displayName:t.displayName,firstName:t.userFirstName,isUserSuspended:t.teamJoinState===C.SUSPENDED,shouldNotifyAdmins:t.assumeShouldNotifyAdmins,success:function(e){h.redirect("/home")}})},i}return i.__extends(t,e),t})(R),J=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Manage files"),i.iconName="manage-files",i.spriteName="actions_manage_files",i.isValid=t.teamJoinState===C.REMOVED&&t.dataTransferrable&&t.canTransferFiles,i.callbackAction=function(){return _.deferredLoader.getItem("show_manage_files_modal").then((function(e){e(t.userId,t.displayName)}))},i}return i.__extends(t,e),t})(R),w=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Reset password"),i.iconName="reset-password",i.actionId="admin_reset_password",i.spriteName="actions_reset",i.isValid=(t.teamJoinState===C.ACTIVE||t.teamJoinState===C.SUSPENDED)&&(t.isAdmin||!t.ssoRequired),i.callbackAction=function(e){return N.showResetPasswordModal({userId:t.userId,userName:t.displayName,successCallback:t.onClose,onRequestClose:t.onClose,onPrimaryAction:t.onClose,onSecondaryAction:function(){e&&"function"==typeof e&&e(),t.onClose&&t.onClose()}})},i}return i.__extends(t,e),t})(R),T=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Disable two-step verification"),i.iconName="disable-2fa",i.spriteName="greyscale-disable-2fa",i.isValid=t.teamJoinState===C.ACTIVE&&t.hasTwoFactor&&t.twoFactorStatus!==b.STATUS_INACTIVE&&t.twoFactorStatus!==b.STATUS_ACTIVE,i.callbackAction=function(){return _.deferredLoader.getItem("team_module").then((function(e){e.show_disable_2fa_modal(null,t.userId,t.displayName)}))},i}return i.__extends(t,e),t})(R),E=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Reset two-step verification"),i.iconName="reset-2fa",i.spriteName="greyscale-reset-2fa",i.isValid=t.teamJoinState===C.ACTIVE&&t.hasTwoFactor&&t.twoFactorStatus===b.STATUS_ACTIVE,i.callbackAction=function(){return l.showReset2FAModal({userId:t.userId,userDisplayName:t.displayName})},i}return i.__extends(t,e),t})(R),M=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Create activity report"),i.iconName="create-activity-report",i.actionId="activity_page_report",i.spriteName="actions_audit_log",i.isValid=(t.teamJoinState===C.ACTIVE||t.teamJoinState===C.SUSPENDED||t.teamJoinState===C.REMOVED)&&t.canViewMemberActivities&&!t.isResellerSupportSession,i.callbackAction=function(e){var i=function(){return U.ShowReportModal({accountId:t.accountId,member:t.displayName,email:u.Viewer.get_viewer().work_email,onPrimaryAction:t.onClose,onSecondaryAction:function(){e&&"function"==typeof e&&e(),t.onClose&&t.onClose()},onRequestClose:t.onClose})};return t.onClose?i():_.deferredLoader.getItem("team_module").then((function(e){if(t.activityRefresh)return i();e.show_user_activity_log_modal(t.userId,u.Viewer.get_viewer().work_email,t.displayName)}))},i}return i.__extends(t,e),t})(R);var O=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Restore member"),i.iconName="unsuspend-user",i.spriteName="actions_reset",i.undoSupported=t.undoSupported,i.redirectOnChangeUrl=t.redirectOnChangeUrl,i.isValid=t.teamJoinState===C.REMOVED&&t.userRecoverable&&t.canRecoverUser,i.callbackAction=function(){return o.showRecoverUserModal({displayName:t.displayName,isUserSuspended:t.preRemovalJoinState===C.SUSPENDED,userId:t.userId,email:t.email,teamJoinDate:t.teamJoinDate,storageUsed:t.storageUsed,accountPhotoUrl:t.accountPhotoUrl,onPrimaryAction:function(){return i.callRefreshMemberStateWithUndo("restored",S._("Member restored"))}})},i}return i.__extends(t,e),t.prototype.callRefreshMemberStateWithUndo=function(e,t,i,s,r){void 0===i&&(i={}),void 0===s&&(s=function(){}),void 0===r&&(r=""),this.undoSupported?c.notifyWithUndo(t,i,s,null,r):(f.Notify.success(S._("Still working...")),h.redirect(this.redirectOnChangeUrl+"&msg="+e))},t})(R),P=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Resend invite"),i.iconName="resend-invite",i.spriteName="menu_reinvite",i.isValid=t.teamJoinState===C.PENDING,i.callbackAction=function(){return m.showResendInviteModal({userId:t.userId,email:t.email})},i}return i.__extends(t,e),t})(R),k=(function(e){function t(t){var i=e.call(this)||this;return i.iconName="change-or-add-admin-permission",i.spriteName="actions_change_admin",i.isValid=t.teamJoinState!==C.REMOVED&&t.canChangeRole&&(t.isAdmin||t.teamJoinState!==C.SUSPENDED),t.allowAdminRoles?(t.isAdmin?i.actionDisplayName=S._("Change admin permissions"):i.actionDisplayName=S._("Add admin permissions"),i.callbackAction=function(){var e=t.userId,r=t.redirectOnChangeUrl,a=t.adminRole?t.adminRole:s.ADMIN_ROLE.NONE;I.showTeamAdminRolesModal({userId:e,displayName:t.displayName||t.email,isAdmin:t.isAdmin,origAdminRole:a,success:function(t){var s=JSON.parse(t)[e].is_admin;return i.callRefreshMemberAdminRole(s,r)}})}):(t.isAdmin?i.actionDisplayName=S._("Remove admin permissions"):i.actionDisplayName=S._("Add admin permissions"),i.callbackAction=function(){return g.showAdminPermissionsModal({userId:t.userId,displayName:t.displayName||t.email,enablePermissions:!t.isAdmin,limited:!1,onPrimaryAction:function(){return i.callRefreshMemberAdminRole(!t.isAdmin,t.redirectOnChangeUrl)}})}),i}return i.__extends(t,e),t.prototype.callRefreshMemberAdminRole=function(e,t){e?h.redirect(t+"&msg=granted"):h.redirect(t+"&msg=removed")},t})(R),V=(function(e){function t(t){var i=e.call(this)||this;return i.actionDisplayName=S._("Unsuspend member"),i.iconName="unsuspend-user",i.actionId="admin_unsuspend_team_member",i.spriteName="menu_unsuspend",i.redirectOnChangeUrl=t.redirectOnChangeUrl,i.undoSupported=t.undoSupported,i.isValid=t.teamJoinState===C.SUSPENDED,i.callbackAction=function(e){return p.showUnsuspendUserModal({displayName:t.displayName,userId:t.userId,email:t.email,teamJoinDate:t.teamJoinDate,storageUsed:t.storageUsed,accountPhotoUrl:t.accountPhotoUrl,onSecondaryAction:function(){e&&"function"==typeof e&&e(),t.onClose&&t.onClose()},onRequestClose:t.onClose,onPrimaryAction:function(){t.onClose&&t.onClose(),i.callRefreshMemberStateWithUndo("unsuspended",S._("Unsuspended %(name)s").format({name:t.displayName}),{},(function(){}),"")}})},i}return i.__extends(t,e),t.prototype.callRefreshMemberStateWithUndo=function(e,t,i,s,r){this.undoSupported?c.notifyWithUndo(t,i,s,null,r):(f.Notify.success(S._("Still working...")),h.redirect(this.redirectOnChangeUrl+"&msg="+e))},t})(R),F=(function(e){function t(t){var i=e.call(this)||this;return i.iconName="suspend-user",i.actionId="admin_deactivate_team_member",i.actionDisplayName=S._("Suspend member"),i.spriteName="menu_remove",i.redirectOnChangeUrl=t.redirectOnChangeUrl,i.undoSupported=t.undoSupported,i.isValid=t.teamJoinState===C.ACTIVE&&t.canDeleteMember,i.callbackAction=function(e){return n.showSuspendUserModal({displayName:t.displayName,userId:t.userId,email:t.email,hideRemoteWipe:!t.canTransferFiles,teamJoinDate:t.teamJoinDate,storageUsed:t.storageUsed,accountPhotoUrl:t.accountPhotoUrl,successCallback:t.onClose||i.callRefreshMemberStateWithUndo.bind(i),onClose:function(i){i&&e&&"function"==typeof e&&e(),t.onClose&&t.onClose()}})},i}return i.__extends(t,e),t.prototype.callRefreshMemberStateWithUndo=function(e,t,i,s,r){this.undoSupported?c.notifyWithUndo(t,i,s,null,r):(f.Notify.success(S._("Still working...")),h.redirect(this.redirectOnChangeUrl+"&msg="+e))},t})(R),L=(function(e){function t(t){var i=e.call(this)||this;return i.iconName="delete-user",i.actionId="admin_remove_team_member",i.actionDisplayName=S._("Delete member"),i.spriteName="menu_delete",i.redirectOnChangeUrl=t.redirectOnChangeUrl,i.undoSupported=t.undoSupported,i.isValid=t.teamJoinState!==C.REMOVED&&t.canDeleteMember,i.callbackAction=function(e){return r.showDeleteUserModal({displayName:t.displayName,userId:t.userId,email:t.email,teamName:t.teamName,numApiApps:t.numApiApps,invited:t.teamJoinState===C.PENDING,isUserSuspended:t.teamJoinState===C.SUSPENDED,hideRemoteWipe:t.teamJoinState!==C.ACTIVE&&t.teamJoinState!==C.PENDING,teamJoinDate:t.teamJoinDate,evhEndDate:t.evhEndDate,mergedPersonalAccount:t.mergedPersonalAccount,deleteInfoMsg:t.deleteInfoMsg,storageUsed:t.storageUsed,accountPhotoUrl:t.accountPhotoUrl,successCallback:t.deleteCallback||i.callRefreshMemberStateWithUndo.bind(i),recoverUserCallback:t.recoverUserCallback||i.recoverUserCallback.bind(i),cancelCallback:function(){e&&"function"==typeof e&&e(),t.onClose&&t.onClose()},noOffboardDueToAAL:t.isAalTosRequired})},i}return i.__extends(t,e),t.prototype.recoverUserCallback=function(e){return o.showRecoverUserModal({displayName:e.user_name,isUserSuspended:e.is_user_suspended,userId:e.user_id,email:e.email,teamJoinDate:e.team_join_date,storageUsed:e.storage_used,accountPhotoUrl:e.account_photo_url,onPrimaryAction:function(){return t=S._("Restored %(display_name)s").format({display_name:e.user_name}),i=!1,s=e.redirectOnChangeUrl,void(i?"restored"===t?f.Notify.success(S._("Member restored")):"unsuspended"===t&&f.Notify.success(S._("Member unsuspended")):(f.Notify.success(S._("Still working...")),h.redirect(s+"&msg="+t)));var t,i,s}})},t.prototype.callRefreshMemberStateWithUndo=function(e,t,i,s,r){this.undoSupported?c.notifyWithUndo(t,i,s,null,r):(f.Notify.success(S._("Still working...")),h.redirect(this.redirectOnChangeUrl+"&msg="+e))},t})(R),q=(function(e){function t(t){var i=e.call(this)||this;return i.iconName="edit-group",i.actionDisplayName=S._("Edit space limit"),i.isValid=t.canSetCustomLimit&&t.teamJoinState===C.ACTIVE,i.callbackAction=function(){return a.showEditSpaceLimitModal({displayName:t.displayName,email:t.email,firstName:t.userFirstName,redirectOnChangeUrl:t.redirectOnChangeUrl,teamCapsType:t.teamCapsType,teamMemberDefaultLimitGB:t.teamMemberDefaultLimitGB,userCustomLimitGB:t.userCustomLimitGB,userUsageString:t.userUsageString})},i}return i.__extends(t,e),t})(R),x=(function(e){function t(t){var i=e.call(this)||this;return i.iconName="permissions",i.groupName=y.IconGroup.Action,i.actionDisplayName=S._("Unlock account"),i.isValid=t.canUnlockUser,i.callbackAction=function(){A.memberUnlockAction(t.accountId,t.redirectOnChangeUrl+"&msg=unlocked")},i}return i.__extends(t,e),t})(R),G=(function(){function e(e){this.properties=e,this.actionItems=[],D(this.actionItems,new v({assumeShouldNotifyAdmins:this.properties.assumeShouldNotifyAdmins,canAssumeUser:this.properties.canAssumeUser,displayName:this.properties.displayName,membershipType:this.properties.membershipType,teamJoinState:this.properties.teamJoinState,userFirstName:this.properties.userFirstName,userId:this.properties.userId}).getItem()),D(this.actionItems,new J({canTransferFiles:this.properties.canTransferFiles,dataTransferrable:this.properties.dataTransferrable,displayName:this.properties.displayName,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId}).getItem()),D(this.actionItems,new w({displayName:this.properties.displayName,isAdmin:this.properties.isAdmin,ssoRequired:this.properties.ssoRequired,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId}).getItem()),D(this.actionItems,new T({displayName:this.properties.displayName,hasTwoFactor:this.properties.hasTwoFactor,teamJoinState:this.properties.teamJoinState,twoFactorStatus:this.properties.twoFactorStatus,userId:this.properties.userId}).getItem()),D(this.actionItems,new E({displayName:this.properties.displayName,hasTwoFactor:this.properties.hasTwoFactor,teamJoinState:this.properties.teamJoinState,twoFactorStatus:this.properties.twoFactorStatus,userId:this.properties.userId}).getItem()),D(this.actionItems,new M({canViewMemberActivities:this.properties.canViewMemberActivities,displayName:this.properties.displayName,isResellerSupportSession:this.properties.isResellerSupportSession,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId,accountId:this.properties.accountId,activityRefresh:this.properties.activityRefresh}).getItem()),D(this.actionItems,new O({accountPhotoUrl:this.properties.accountPhotoUrl,canRecoverUser:this.properties.canRecoverUser,displayName:this.properties.displayName,email:this.properties.email,preRemovalJoinState:this.properties.preRemovalJoinState,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,storageUsed:this.properties.storageUsed,teamJoinState:this.properties.teamJoinState,teamJoinDate:this.properties.teamJoinDate,userId:this.properties.userId,userRecoverable:this.properties.userRecoverable,undoSupported:this.properties.undoSupported}).getItem()),D(this.actionItems,new P({email:this.properties.email,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId}).getItem()),D(this.actionItems,new k({adminRole:this.properties.adminRole,allowAdminRoles:this.properties.allowAdminRoles,canChangeRole:this.properties.canChangeRole,displayName:this.properties.displayName,email:this.properties.email,isAdmin:this.properties.isAdmin,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId}).getItem()),D(this.actionItems,new V({accountPhotoUrl:this.properties.accountPhotoUrl,displayName:this.properties.displayName,email:this.properties.email,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,storageUsed:this.properties.storageUsed,teamJoinDate:this.properties.teamJoinDate,teamJoinState:this.properties.teamJoinState,undoSupported:this.properties.undoSupported,userId:this.properties.userId}).getItem()),D(this.actionItems,new F({accountPhotoUrl:this.properties.accountPhotoUrl,canDeleteMember:this.properties.canDeleteMember,canTransferFiles:this.properties.canTransferFiles,displayName:this.properties.displayName,email:this.properties.email,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,storageUsed:this.properties.storageUsed,teamJoinDate:this.properties.teamJoinDate,teamJoinState:this.properties.teamJoinState,undoSupported:this.properties.undoSupported,userId:this.properties.userId}).getItem()),D(this.actionItems,new L({accountPhotoUrl:this.properties.accountPhotoUrl,canDeleteMember:this.properties.canDeleteMember,canTransferFiles:this.properties.canTransferFiles,displayName:this.properties.displayName,email:this.properties.email,teamJoinDate:this.properties.teamJoinDate,evhEndDate:this.properties.evhEndDate,numApiApps:this.properties.numApiApps,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,mergedPersonalAccount:this.properties.mergedPersonalAccount,deleteInfoMsg:this.properties.deleteInfoMsg,storageUsed:this.properties.storageUsed,teamJoinState:this.properties.teamJoinState,teamName:this.properties.teamName,undoSupported:this.properties.undoSupported,userId:this.properties.userId,isAalTosRequired:this.properties.isAalTosRequired}).getItem()),D(this.actionItems,new q({canSetCustomLimit:this.properties.canSetCustomLimit,displayName:this.properties.displayName,email:this.properties.email,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,teamJoinState:this.properties.teamJoinState,teamCapsType:this.properties.mslTeamCapsType,teamMemberDefaultLimitGB:this.properties.mslTeamMemberDefaultLimitGb,userCustomLimitGB:this.properties.mslUserCustomLimitGb,userFirstName:this.properties.userFirstName,userUsageString:this.properties.userUsageString}).getItem()),D(this.actionItems,new x({canUnlockUser:this.properties.canUnlockUser,accountId:this.properties.accountId,redirectOnChangeUrl:this.properties.redirectOnChangeUrl}).getItem())}return e.prototype.getPrimaryActionItem=function(){return this.actionItems[0]},e.prototype.getSecondaryActionsItems=function(){return this.actionItems.slice(1)},e})();t.MemberSidebarActions=G;var W=(function(){function e(e){this.properties=i.__assign(i.__assign({},e),{redirectOnChangeUrl:"",isResellerSupportSession:!1,activityRefresh:!0,undoSupported:!0,ssoRequired:!1}),this.actionItems=[],D(this.actionItems,new w({displayName:this.properties.displayName,isAdmin:this.properties.isAdmin,ssoRequired:this.properties.ssoRequired,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId,onClose:this.properties.onClose}).getItem()),D(this.actionItems,new M({canViewMemberActivities:this.properties.canViewMemberActivities,displayName:this.properties.displayName,isResellerSupportSession:this.properties.isResellerSupportSession,teamJoinState:this.properties.teamJoinState,userId:this.properties.userId,accountId:this.properties.accountId,activityRefresh:this.properties.activityRefresh,onClose:this.properties.onClose}).getItem()),D(this.actionItems,new V({accountPhotoUrl:this.properties.accountPhotoUrl,displayName:this.properties.displayName,email:this.properties.email,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,storageUsed:this.properties.storageUsed,teamJoinDate:this.properties.teamJoinDate,teamJoinState:this.properties.teamJoinState,undoSupported:this.properties.undoSupported,userId:this.properties.userId,onClose:this.properties.onClose}).getItem()),D(this.actionItems,new F({accountPhotoUrl:this.properties.accountPhotoUrl,canDeleteMember:this.properties.canDeleteMember,canTransferFiles:this.properties.canTransferFiles,displayName:this.properties.displayName,email:this.properties.email,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,storageUsed:this.properties.storageUsed,teamJoinDate:this.properties.teamJoinDate,teamJoinState:this.properties.teamJoinState,undoSupported:this.properties.undoSupported,userId:this.properties.userId,onClose:this.properties.onClose}).getItem()),D(this.actionItems,new L({accountPhotoUrl:this.properties.accountPhotoUrl,canDeleteMember:this.properties.canDeleteMember,canTransferFiles:this.properties.canTransferFiles,displayName:this.properties.displayName,email:this.properties.email,teamJoinDate:this.properties.teamJoinDate,evhEndDate:this.properties.evhEndDate,numApiApps:this.properties.numApiApps,redirectOnChangeUrl:this.properties.redirectOnChangeUrl,mergedPersonalAccount:this.properties.mergedPersonalAccount,storageUsed:this.properties.storageUsed,teamJoinState:this.properties.teamJoinState,teamName:this.properties.teamName,undoSupported:this.properties.undoSupported,userId:this.properties.userId,isAalTosRequired:this.properties.isAalTosRequired,deleteCallback:this.properties.deleteCallback,recoverUserCallback:this.properties.recoverUserCallback,onClose:this.properties.onClose}).getItem())}return e.prototype.getActionsItems=function(){return this.actionItems},e})();t.MemberInviteSidebarActions=W}));
//# sourceMappingURL=member_sidebar_actions.min.js-vflVGZJDX.map