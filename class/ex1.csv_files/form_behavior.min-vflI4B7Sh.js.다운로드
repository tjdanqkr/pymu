define(["require","exports","tslib","rondo/v1/index","rondo-saga/v1","rondo-forms/v1/types","rondo-forms/v1/utils"],(function(e,t,n,r,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FormBehavior=function(e){var t=e.fields,c=e.validator,s=e.commitActions,u=e.resetActions,l=e.clearActions,d=e.changeAction;return(function(){function e(){this.initialState=function(){return{validInfo:a.ValidInfoValid}},this.actionReset=r.createOrUseIn(this,u).watch((function(){return Object.keys(t).forEach((function(e){return t[e].actionReset&&t[e].actionReset()}))})),this.actionCommit=r.createOrUseIn(this,s).watch((function(){return Object.keys(t).forEach((function(e){return t[e].actionCommit&&t[e].actionCommit()}))})),this.actionClear=r.createOrUseIn(this,l).watch((function(){return Object.keys(t).forEach((function(e){return t[e].actionClear&&t[e].actionClear()}))})),this.actionSetValues=r.createAction().watch((function(e,n){var r=n.fieldsToValue,i=n.setAsInitial,a=void 0!==i&&i;r&&Object.keys(r).forEach((function(e){t[e]&&(a?t[e].actionFieldSet(r[e]):t[e].actionFieldChange(r[e]))}))})),this.actionFieldSetValid=r.createAction().handle((function(e,t){return{validInfo:t}})),this.actionValidate=r.createAction(),this.actionChanged=r.createOrUseIn(this,d),this.dirtyFields=r.createSelector.apply(void 0,n.__spread(Object.keys(t).map((function(e){return t[e].dirty})),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Object.keys(t).filter((function(t,n){return e[n]}))}])),this.dirty=r.createSelector(this.dirtyFields,(function(e){return e.length>0})),this.values=r.createSelector.apply(void 0,n.__spread(Object.keys(t).map((function(e){return t[e].fieldValue})),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Object.keys(t).reduce((function(t,n,r){return t[n]=e[r],t}),{})}])),this.validFields=r.createSelector.apply(void 0,n.__spread(Object.keys(t).map((function(e){return t[e].valid})),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Object.keys(t).filter((function(t,n){return e[n]}))}])),this.validInfo=r.createSelector((function(e){return e.validInfo})),this.valid=r.createSelector(this.validFields,this.validInfo,(function(e,n){return e.length===Object.keys(t).length&&(!n||n&&n.valid)})),this.validMessage=r.createSelector((function(e){var t=e.validInfo;return t&&t.message?t.message:void 0})),this.validValues=r.createSelector(this.values,this.validFields,(function(e,t){return Object.keys(e).filter((function(e){return t.indexOf(e)>=0})).reduce((function(t,n){return t[n]=e[n],t}),{})})),this.initialValues=r.createSelector.apply(void 0,n.__spread(Object.keys(t).map((function(e){return t[e].initialValue})),[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return Object.keys(t).reduce((function(t,n,r){return t[n]=e[r],t}),{})}]))}return e.prototype.formChangeSaga=function(){var e,t,r,a,s;return n.__generator(this,(function(n){switch(n.label){case 0:if(!c)return[2];if(e=c(this.values()),!o.isPromise(e))return[3,7];n.label=1;case 1:return n.trys.push([1,4,,6]),[4,e];case 2:return t=n.sent(),r=t.type,a=t.valid,s=t.message,[4,i.put(this.actionFieldSetValid)({message:s,valid:a,type:r||(a?"valid":"error")})];case 3:return n.sent(),[3,6];case 4:return n.sent(),[4,i.put(this.actionFieldSetValid)({valid:!1,type:"error",message:void 0})];case 5:return n.sent(),[3,6];case 6:return[3,9];case 7:return[4,i.put(this.actionFieldSetValid)({message:e.message,valid:!!e.valid,type:e.type||o.validStringType(!!e.valid)})];case 8:n.sent(),n.label=9;case 9:return[2]}}))},e.prototype.onFieldChanged=function(){return n.__generator(this,(function(e){switch(e.label){case 0:return[4,i.delay(25)];case 1:return e.sent(),[4,i.put(this.actionChanged)()];case 2:return e.sent(),[2]}}))},e.prototype.run=function(){return n.__generator(this,(function(e){switch(e.label){case 0:return[4,this.formChangeSaga()];case 1:return e.sent(),[2]}}))},e.displayName="FormBehavior",n.__decorate([i.decorators.takeEvery(["actionValidate","actionChanged"])],e.prototype,"formChangeSaga",null),n.__decorate([i.decorators.takeLatest(Object.keys(t).map((function(e){return t[e].actionFieldChanged})))],e.prototype,"onFieldChanged",null),n.__decorate([r.saga],e.prototype,"run",null),e})()}}));
//# sourceMappingURL=form_behavior.min.js-vflBtIlJa.map