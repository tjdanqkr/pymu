define(["require","exports","tslib","modules/clean/filepath","modules/clean/react/delorean/util","modules/clean/react/delorean/util","modules/core/i18n","modules/clean/viewer","modules/clean/datetime","modules/clean/react/delorean/data/tooltips","modules/clean/browse_interface","modules/core/uri","modules/clean/react/delorean/data/headings","modules/clean/react/delorean/data/types","modules/constants/page_load"],(function(e,t,a,o,n,r,i,d,m,c,l,s,_,u,p){"use strict";function f(e){var t=e.getTime(),a=m.getTimeBands(Date.now());return t>=a.today?i._("Today",{project:"folder-history"}):t>=a.yesterday?i._("Yesterday",{project:"folder-history"}):m.nice_date_with_month_name(e,!0)}function h(e){var t=e.eventPath,a=e.user;return void 0===t?void 0:""===t?d.Viewer.get_root_name(a):o.child_dir(t)}Object.defineProperty(t,"__esModule",{value:!0}),o=a.__importStar(o),n=a.__importStar(n),p=a.__importStar(p),t.getEventCardDate=f,t.createDateBanner=function(e){return{type:u.DeloreanEventType.dateBanner,eventCardDate:f(e),date:n.floorDate(e)}},t.createEmptyDay=function(e){return{type:u.DeloreanEventType.emptyDay,date:e,uid:n.getUid()}},t.getProcessedEvent=function(e){var t=e.event,a=e.path,d=(e.currentFolder,e.user),m=0;if(t.object_metadata)if(n.isMetadataType(t.object_metadata,"single_object_metadata")||n.isMetadataType(t.object_metadata,"multi_object_metadata")||n.isMetadataType(t.object_metadata,"rename_metadata")||n.isMetadataType(t.object_metadata,"move_metadata")||n.isMetadataType(t.object_metadata,"move_in_metadata")||n.isMetadataType(t.object_metadata,"move_out_metadata")||n.isMetadataType(t.object_metadata,"rollback_metadata"))m=t.object_metadata.contents_count||0;else if(n.isMetadataType(t.object_metadata,"edit_metadata"))m=1;else{if(!n.isMetadataType(t.object_metadata,"other"))return r.assertNever(t.object_metadata);m=1}0===m&&(m=1);var v=new Date(t.timestamp_us/1e3),y=null;t.object_metadata&&n.isMetadataType(t.object_metadata,"rollback_metadata")&&0!==t.object_metadata.to_timestamp&&(y=new Date(t.object_metadata.to_timestamp/1e3));var g,b=p.USER_LOCALE.replace("_","-"),j=new Intl.DateTimeFormat(b,{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),T=j.format(v),D=new Intl.DateTimeFormat(b,{weekday:"short",month:"short",day:"numeric"}).format(v),w=y?j.format(y):null,M=new Intl.DateTimeFormat(b,{hour:"numeric",minute:"2-digit"}).format(v),E=o.normalize(n.getLocationOfMetadata(t.object_metadata)),P=E+o.normalize(n.getRepresentativeNameOfMetadata(t.object_metadata))===a,F=t.actor.account_id===d.id,z=c.getTooltipForEvent({isYou:F,event:t,itemCount:m,path:a,relativeFolderDisplayPath:""}),C=_.getHeadlineForEvent({event:t,isYou:F,user:d,objectIsCurrentFolder:P,fullRollbackDate:w});g=n.isOpType(t.op_type,"delete")?new s.URI({scheme:"https",authority:"www.dropbox.com",path:"/deleted_files"}):l.browse_uri_for_fq_path(d,E);var O=P?void 0:(function(e){var t=e.event,a=e.user,d=e.path,m=t.object_metadata;if("from_containing_path"in m&&"to_containing_path"in m){var c=h({eventPath:m.from_containing_path,user:a}),l=h({eventPath:m.to_containing_path,user:a});return i._("from %(src)s to %(dst)s",{project:"folder-history"}).format({src:c,dst:l})}if("from_containing_path"in m){c=h({eventPath:m.from_containing_path,user:a});return i._("from %(location)s",{project:"folder-history"}).format({location:c})}if("to_containing_path"in m){l=h({eventPath:m.to_containing_path,user:a});return o.normalize(m.to_containing_path)!==o.normalize(d)?i._("to %(location)s",{project:"folder-history"}).format({location:l}):void 0}if("containing_path"in m){var s=h({eventPath:m.containing_path,user:a});return""===o.normalize(m.containing_path)&&"name"in m&&""===m.name?void 0:o.normalize(m.containing_path)!==o.normalize(d)?i._("in %(location)s",{project:"folder-history"}).format({location:s}):void 0}if(!n.isMetadataType(m,"other"))return r.assertNever(m)})({event:t,user:d,path:a});return{type:u.DeloreanEventType.event,actor:t.actor,count:m,browseHref:g,eventCardDate:f(v),confirmationCardDate:T,formattedDate:D,date:v,tooltip:z,uid:r.getUid(),eventHeadline:C,timestamp:v.getTime(),displayTooltip:z!==C,cardSubheading:O,operationName:n.getNameOfOpType(t.op_type),timeAgo:M}},t.getRootFolderName=function(e,t){return"personal"===e.role?t.is_paired?i._("Personal",{project:"folder-history"}):i._("Dropbox",{project:"folder-history"}):t.team_name},t.checkHasDataThisWeek=function(e,t,a){return e.slice(e.length-t,e.length-a).reduce((function(e,t){return e+t.count}),0)>0}}));
//# sourceMappingURL=reducer_helpers.min.js-vflY9Qj2N.map