define(["require","exports","tslib","modules/clean/react/file_transfers/lib/api","external/lodash","modules/core/cookies","modules/clean/display_format","modules/clean/downloads","modules/clean/react/file_transfers/redux/types","modules/clean/react/file_transfers/uploader/types","modules/clean/react/file_transfers/constants","modules/clean/filepath","modules/clean/uuid","modules/core/i18n","file-transfers/common/constants","file-transfers/common/types","modules/constants/time","modules/clean/datetime"],(function(e,t,n,r,a,o,i,l,s,u,c,f,d,m,_,p,g,h){"use strict";function S(e){var t=localStorage.getItem(e);return null===t?null:parseInt(t,10)}function E(e,t){localStorage.setItem(e,t.toString())}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),l=n.__importStar(l),h=n.__importStar(h),t.contactToFileTransfersEmailRecipient=function(e){return{recipient:{".tag":"email_address",email_address:e.email}}},t.sortByCreationTimeDesc=function(e){return n.__spreadArrays(e).sort((function(e,t){return e.creation_time<t.creation_time?1:t.creation_time<e.creation_time?-1:0}))},t.formatBytes=function(e,t){return void 0===t&&(t={}),void 0===t.numDecimalPlaces&&(e<i.SWITCH_UNIT_THRESHOLD*_.BYTES_IN_KILOBYTE?t.numDecimalPlaces=0:e<i.SWITCH_UNIT_THRESHOLD*_.BYTES_IN_MEGABYTE?t.numDecimalPlaces=1:t.numDecimalPlaces=2),i.format_bytes(e,t.numDecimalPlaces,t.includeSpace,t.lazy,t.allowNegative)},t.hasValidEmail=function(e){return c.VALID_EMAIL_REGEX.test(e.email)},t.incrementLocalStorageValueForKey=function(e){var t=S(e);E(e,t?t+1:1)},t.getLocalStorageNumberValueForKey=S,t.getLocalStorageBooleanValueForKey=function(e){var t=localStorage.getItem(e);return null===t?null:"true"===t},t.setLocalStorageValueForKey=E,t.HAS_USER_AGREED_TO_LOGGED_OUT_TRANSFER_TOS_KEY="transfer_agreed_to_tos",t.hasUserAgreedToLoggedOutTransferTOS=function(){return!!o.Cookies.read(t.HAS_USER_AGREED_TO_LOGGED_OUT_TRANSFER_TOS_KEY)},t.markUserAgreedToLoggedOutTransferTOS=function(){o.Cookies.create(t.HAS_USER_AGREED_TO_LOGGED_OUT_TRANSFER_TOS_KEY,"true")},t.hasAtLeastOneFileDownloaded=function(e){return null!==sessionStorage.getItem("fileTransferAtLeastOneFileDownloaded:"+e)},t.markAtLeastOneFileDownloaded=function(e){sessionStorage.setItem("fileTransferAtLeastOneFileDownloaded:"+e,"true")};t.hasEverSetBackground=function(){return null!==localStorage.getItem("fileTransferEverSetBackground")},t.markHasEverSetBackground=function(){localStorage.setItem("fileTransferEverSetBackground","true")};function T(e,t,n){return 0===e.length?m._("Transfer with no items",{comment:"title of transfer when there are no files or folders in it"}):t<=1?m._("%(item_name)s",{comment:"Name of the first file or folder in a file transfer"}).format({item_name:n?D(e[0]):e[0]}):m._("%(item_name)s + %(item_count)d",{comment:"Name of the first file or folder in a file transfer and how many others are in the transfer"}).format({item_name:n?D(e[0]):e[0],item_count:t-1})}function D(e){var t=e;e.length>c.MAX_LEN_OF_FILE_NAME&&(t=e.slice(0,c.LEN_OF_FILE_NAME_PREFIX)+"..."+e.slice(e.length-c.LEN_OF_FILE_NAME_SUFFIX));return t}function F(e){return null===v(e)}function v(e){var t;if("dest"in e)t=e.dest;else if("fullPath"in e){if(!e.fullPath)return null;"/"===(t=e.fullPath).charAt(0)&&(t=e.fullPath.substring(1))}else{if(!("path"in e))throw new Error("file must be either PluploadFile, StateFileInfo, or FileSystemEntry");if(!e.path)return null;t=e.path}var n=t.split("/");return n.length<=1?null:n[0]}function A(e,t){void 0===t&&(t={});for(var n=document.getElementsByName("file-downloads-iframe"),r=0,a=Array.from(n);r<a.length;r++){var o=a[r];o&&o.parentNode&&o.parentNode.removeChild(o)}var i=document.createElement("iframe");i.name="file-downloads-iframe",i.src="about:blank",i.setAttribute("style","display: none;"),document.body.appendChild(i);var l=i.contentDocument,s=l.createElement("form");s.action=e,s.method="post",Object.keys(t).forEach((function(e){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t[e],s.appendChild(n)})),l.body.appendChild(s),s.submit()}function y(e,n){return Math.round((n.getTime()-e.getTime())/t.DAYS_IN_MS)}function I(e){return function(t){return(function(e){return e.value?e.value[".tag"]:"other"})(t)===e}}t.hasEverSetLogo=function(){return null!==localStorage.getItem("fileTransferHasEverSetLogo")},t.markHasEverSetLogo=function(){localStorage.setItem("fileTransferHasEverSetLogo","true")},t.generateTransferSummaryTitle=function(e,t){return T(e.summary_file_names,e.display_file_count,t)},t.generateTransferTitle=T,t.formatLongFileNameForDisplay=D,t.createDirectoryStateFileInfo=function(e,t,n){return void 0===n&&(n=u.FileRole.Content),{id:d.UUID.v4(),isDir:!0,path:e,size:0,source:t,role:n,thumbnailUrl:null}},t.transferFileAsStateFileInfo=function(e,t){return void 0===t&&(t=u.FileRole.Content),{id:e.transfer_file_id,isDir:e.obsolete_is_dir,path:e.relative_path,size:e.file_size,source:u.FileSource.Transfer,role:t,thumbnailUrl:e.thumbnail_url||null}},t.chooserFileAsStateFileInfo=function(e,t){var n=e.id,r=e.isDir,a=e.name,o=e.bytes;return void 0===t&&(t=u.FileRole.Content),{id:n,isDir:r,path:a,size:o,source:u.FileSource.Dropbox,role:t,thumbnailUrl:null}},t.pluploadFileAsStateFileInfo=function(e,t){return void 0===t&&(t=u.FileRole.Content),{id:e.id,isDir:0===e.size,path:e.dest,size:e.size,source:u.FileSource.Computer,role:t,thumbnailUrl:null}},t.fileAsStateFileInfo=function(e,t){return void 0===t&&(t=u.FileRole.Content),{path:e.name,id:e.name,size:e.size||0,isDir:!1,source:u.FileSource.Computer,thumbnailUrl:null,role:t}},t.stateFileInfoAsFileInfo=function(e,t){return void 0===t&&(t={}),n.__assign({id:e.id,isDir:e.isDir,name:e.path,size:e.size,thumbnailUrl:e.thumbnailUrl},t)},t.sumBytes=function(e){return e.reduce((function(e,t){return e+t.size}),0)},t.fileSystemDirectoryEntryAsStateFileInfo=function(e,t){return void 0===t&&(t=u.FileRole.Content),{id:d.UUID.v4(),isDir:!0,path:e.fullPath?e.fullPath.substring(1):e.name,size:0,source:u.FileSource.Computer,role:t,thumbnailUrl:null}},t.isAtRoot=F,t.getRootDirectory=v,t.getTransferFilesKey=function(e){return e||c.NULL_FILE_TRANSFER_KEY},t.isLocalDirectory=function(e){return e.isDir&&e.source===u.FileSource.Computer},t.downloadZipFromUrl=A,t.downloadFiles=function(e,t,a){return n.__awaiter(this,void 0,Promise,(function(){var o;return n.__generator(this,(function(n){return(o=r.downloadFiles(t,e,a)).then((function(e){var t=e.post_params?JSON.parse(e.post_params):{},n=e.url.toString();0===Object.keys(t).length?l.get({url:n}):A(n,t)})),o.catch((function(e){})),[2,o]}))}))},t.renameDuplicateFiles=function(e,t){void 0===t&&(t=[]);var r=[],a=[],o=new Set,i=new Set;return t.filter((function(e){return F(e)})).forEach((function(e){o.add(e.id),i.add(e.path.toLowerCase())})),e.forEach((function(e){var t,l,s=f.split_filename(e.path);if(i.has(e.path.toLowerCase())){if(o.has(e.id))return;var u=1,c=void 0;do{c=s.name+" ("+u+")",t=s.ext?c+"."+s.ext:c,u++}while(i.has(t.toLowerCase()));o.add(e.id),i.add(t.toLowerCase()),l=n.__assign(n.__assign({},e),{path:t}),r.push(l)}else F(e)?(o.add(e.id),i.add(e.path.toLowerCase()),l=n.__assign({},e)):l=n.__assign({},e);a.push(l)})),{files:a,filesRenamed:r}},t.DAYS_IN_MS=864e5,t.getDateDiff=y,t.estimateExpirationOption=function(e,t){var n=y(new Date(e.getFullYear(),e.getMonth(),e.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate()));switch(n){case p.ExpirationOption.THREE_DAYS:case p.ExpirationOption.SEVEN_DAYS:case p.ExpirationOption.THIRTY_DAYS:case p.ExpirationOption.NINETY_DAYS:return n;default:return p.ExpirationOption.CUSTOM}},t.getUpsellProps=function(e){switch(e){case s.UpsellVariant.TRY_PROFESSIONAL:return{productName:"Professional",ctaCopy:m._("Try Professional free",{comment:"text on a CTA button or a link for upselling. The CTA asks user to try using Dropbox Professional Individual Plan for free."}),ctaLink:"/pro/try"};case s.UpsellVariant.BUY_PROFESSIONAL:return{productName:"Professional",ctaCopy:m._("Try Professional",{comment:"text on a CTA button or a link for upselling. The CTA asks user to upgrade to Dropbox Professional Individual Plan."}),ctaLink:"/buy/professional"};case s.UpsellVariant.TRY_BUSINESS_ADVANCED:return{productName:"Advanced",ctaCopy:m._("Try Business Advanced free",{comment:"text on a CTA button or a link for upselling. The CTA asks user to try using Dropbox Advanced Business Plan for free."}),ctaLink:"/business/try"};case s.UpsellVariant.CONTACT_ADMIN:return{productName:"Advanced",ctaCopy:m._("Contact admin",{comment:"text on a CTA button or a link for upselling. The CTA asks user to contact their team admin."}),ctaLink:"/team#members"}}};var C=I("image"),L=I("video");function O(e){return!!e.asset&&C(e.asset)}function U(e){return!!e.asset&&L(e.asset)}function N(e,t){return t?a.filter(t,(function(t){return t.status===e})).length:0}t.isColorBackground=function(e){return!!e.color_hex&&!e.asset},t.isImageBackground=O,t.isVideoBackground=U,t.getImageBackgroundAsset=function(e){return O(e)?e.asset.value:null},t.getVideoBackgroundAsset=function(e){return U(e)?e.asset.value:null},t.generateTransferTrackingId=function(){return d.UUID.v4()},t.numWaiting=function(e){return N(u.UploadStatus.Waiting,e)},t.numSuccess=function(e){return N(u.UploadStatus.Success,e)},t.getChildrenFiles=function(e,t){if(!e.isDir)throw Error("Can only get children of a directory");return t.filter((function(t){return t.path!==e.path&&t.path.startsWith(e.path+"/")}))},t.areItemsUploaded=function(e,t){return e.every((function(e){return t[e.id]&&t[e.id].status===u.UploadStatus.Success}))},t.computeCreationRelativeExpirationDate=function(e,t){var n=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())},r=n(t)-n(e);return new Date(+e+r)},t.formatDate=function(e){return h.format_date(e,g.DATE_FORMAT).replace(/-/gi,"/")}}));
//# sourceMappingURL=utils.min.js-vflTo2byb.map