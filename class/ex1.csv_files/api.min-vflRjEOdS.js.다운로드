define(["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/react/browse/models","modules/core/i18n","modules/clean/react/snackbar","modules/clean/components/modals/show_modal","modules/clean/react/locked_files/view/modals/lock_confirm_modal","modules/clean/react/locked_files/view/modals/request_unlock_confirm_modal","modules/clean/filepath","modules/core/cookies"],(function(e,n,o,t,i,s,r,c,l,a,u,f){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),u=o.__importStar(u);function m(){return s._("Unlocked editing. Any one else with access can edit again.",{comment:"Message shown when unlocking a file for editing from list on web"})}function d(){return s._("Unlocking editing failed.",{comment:"Error message shown when unlocking a file for editing from list on web"})}function k(e){return{entries:e.map((function(e){return{path:e.fq_path}}))}}function _(e){return e.result.then((function(n){return n.entries&&n.entries.length>0&&n.entries.every((function(e){return"success"===e[".tag"]}))?(r.Snackbar.complete(e.onSuccessMsg(n),"file-lock-status"),Promise.resolve()):Promise.reject()})).catch((function(){return r.Snackbar.fail(e.onFailMsg,"file-lock-status"),Promise.reject()}))}function h(e,n){return o.__awaiter(this,void 0,void 0,(function(){var i;return o.__generator(this,(function(o){switch(o.label){case 0:return i=new t.UserApiV2Client,[4,_({result:i.ns("files").rpc("lock_file_batch",k(n),{subjectUserId:e}),onSuccessMsg:function(e){return s._("Editing locked. Now only you can make changes.",{comment:"Message shown when locking a file for editing from list on web"})},onFailMsg:s._("Locking editing failed.",{comment:"Error message shown when locking a file for editing from list on web"})})];case 1:return o.sent(),[2]}}))}))}function g(e,n){return o.__awaiter(this,void 0,void 0,(function(){var r,c,l;return o.__generator(this,(function(o){switch(o.label){case 0:return r=i.File.getFilename(n[0]),c=n[0].lockholder_name,l=new t.UserApiV2Client,[4,_({result:l.ns("files").rpc("request_unlock_file_batch",k(n),{subjectUserId:e}),onSuccessMsg:function(e){var n=e.entries[0];return n.lock&&n.lock.content&&"unlocked"===n.lock.content[".tag"]?m():s._("Asked %(name)s to unlock %(filename)s",{comment:"Message shown when requesting an unlock of a file from another user on web"}).format({filename:r,name:c})},onFailMsg:s._("Error asking %(name)s to unlock %(filename)s",{comment:"Error message shown when requesting an unlock of a file from another user on web"}).format({filename:r,name:c})})];case 1:return o.sent(),[2]}}))}))}n.unlockSuccessString=m,n.unlockFailureString=d,n.showFeedbackForFileLockAction=_,n.asyncLockFile=h,n.asyncUnlockFile=function(e,n){return o.__awaiter(this,void 0,void 0,(function(){var i;return o.__generator(this,(function(o){switch(o.label){case 0:return i=new t.UserApiV2Client,[4,_({result:i.ns("files").rpc("unlock_file_batch",k(n),{subjectUserId:e}),onSuccessMsg:function(e){return m()},onFailMsg:d()})];case 1:return o.sent(),[2]}}))}))},n.asyncRequestUnlockFile=g,n.showFileLockConfirmModal=function(e,n){var o=function(){h(e,[n])};"true"===f.Cookies.read("do_not_show_lock_confirmation_dialog")?o():c.showModal(l.FileLockConfirmModal({filename:u.filename(n.fq_path),onLock:o,onNeverShowAgain:function(){f.Cookies.create("do_not_show_lock_confirmation_dialog","true",365)}}))},n.showRequestUnlockConfirmModal=function(e,n){void 0!==n.ts_locked&&void 0!==n.lockholder_name?c.showModal(a.RequestUnlockConfirmModal({lockCreatedTime:n.ts_locked,lockholderName:n.lockholder_name,onRequestUnlock:function(){g(e,[n])}})):r.Snackbar.fail(s._("Could not ask to unlock. Please try again later.",{comment:"An error message when a user could not ask a user with exclusive edit permissions on a file to give up those permissions. Shown in a snackbar"}),"file-lock-status")}}));
//# sourceMappingURL=api.min.js-vfl76yW27.map