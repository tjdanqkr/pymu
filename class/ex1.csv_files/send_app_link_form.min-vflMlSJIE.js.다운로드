define(["require","exports","tslib","react","react-dom","modules/clean/react/css","modules/clean/static_urls","phone_helpers","modules/constants/viewer","modules/core/notify","modules/core/i18n","modules/clean/ajax","modules/clean/react/growth/send_app_link_form_disclaimer","modules/clean/validators/email_validator","modules/core/dom"],(function(e,t,n,r,a,o,i,u,s,l,p,m,d,c,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importDefault(r),a=n.__importStar(a),u=n.__importStar(u),s=n.__importStar(s),m=n.__importStar(m),c=n.__importDefault(c),_=n.__importStar(_);var f,h,S=["AQ","BV","PN"];(function(e){e.SENDING="sending",e.SUCCESS="success",e.INVALID="invalid",e.FAILURE="failure"})(f=t.SendStatus||(t.SendStatus={})),(function(e){e.SMS="sms",e.EMAIL="email"})(h=t.SendAppLinkFormType||(t.SendAppLinkFormType={})),(function(e){e.RIGHT="button-right",e.BOTTOM="button-bottom"})(t.SendAppLinkButtonPosition||(t.SendAppLinkButtonPosition={})),t.showStatusUsingNotify=function(e){var t=e.currentFormType,n=e.sendStatus,r=e.phoneNumber,a=e.email;switch(l.Notify.clear(),n){case f.SENDING:l.Notify.info(p._("Sending"),60);break;case f.SUCCESS:var o=void 0;switch(t){case h.SMS:o=p._("Link sent to %(phone_number)s").format({phone_number:r});break;case h.EMAIL:o=p._("Link sent to %(email)s").format({email:a})}o&&l.Notify.success(o,3);break;case f.INVALID:var i=void 0;switch(t){case h.SMS:i=p._("Please enter a valid phone number");break;case h.EMAIL:i=p._("Please enter a valid email address")}i&&l.Notify.error(i,3);break;case f.FAILURE:l.Notify.error(p._("There was an error sending the link"),3)}};var b=(function(e){function t(t){var n=e.call(this,t)||this;if(n.getUnformattedNumber=function(e){return(e=e||n.state.phoneNumber).replace(/[^\d]/g,"")},n.isPhoneNumberValid=function(e){e=e||n.state.phoneNumber;var t=n.getPhoneNumberPlaceholder();return n.getUnformattedNumber(e).length===n.getUnformattedNumber(t).length},n.isEmailValid=function(e){return e=e||n.state.email,c.default.validate(e).every((function(e){return e.valid}))},n.handleSubmit=function(e){switch(e.preventDefault(),n.state.currentFormType){case h.SMS:n.state.sendStatus!==f.SENDING&&(n.isPhoneNumberValid()?(n.setState({sendStatus:f.SENDING}),m.SilentBackgroundRequest({url:"/text_mobile_app",data:{country_code:n.getCountryCode(),phone_number:n.getUnformattedNumber()},success:function(e){"True"===e?n.setState({sendStatus:f.SUCCESS}):n.setState({sendStatus:f.FAILURE})},error:function(){n.setState({sendStatus:f.FAILURE})}})):n.setState({sendStatus:f.INVALID}));break;case h.EMAIL:n.state.sendStatus!==f.SENDING&&(n.isEmailValid()?(n.setState({sendStatus:f.SENDING}),m.SilentBackgroundRequest({url:"/email_mobile_app",data:{recipient_email:n.state.email},success:function(e){"True"===e?n.setState({sendStatus:f.SUCCESS}):n.setState({sendStatus:f.FAILURE})},error:function(){n.setState({sendStatus:f.FAILURE})}})):n.setState({sendStatus:f.INVALID}))}n.props.onSubmit&&n.props.onSubmit(e)},n.handlePhoneNumberInput=function(){n.phoneNumberInput&&n.setState({phoneNumber:n.phoneNumberInput.value})},n.handleCountryCodeInput=function(){n.countrySelect&&n.setState({countryAbbreviation:n.countrySelect.value,phoneNumber:""})},n.getStateIconElement=function(){var e;switch(n.state.sendStatus){case f.SUCCESS:e=i.static_url("/static/images/home/experiments/checkmark-vflUJLI49.svg");break;case f.INVALID:e=i.static_url("/static/images/home/experiments/error-vflNe4epB.svg");break;default:return null}return r.default.createElement("img",{src:e,"aria-hidden":"true",className:"send-app-link-form__phone-number__icon"})},n.getCountryIso=function(){return u.iso_to_dialing(n.state.countryAbbreviation)},n.getPhoneNumberPlaceholder=function(){return u.get_example_mobile_number(n.getCountryIso())},n.getCountryCode=function(e){return e=e||n.state.countryAbbreviation,n.props.phoneInputData?n.props.phoneInputData.phone_code_map[e]:null},n.setCountrySelectRef=function(e){return n.countrySelect=e},n.setPhoneNumberInputRef=function(e){return n.phoneNumberInput=e},n.handleFocusCountryCode=function(){n.setState({isCountryCodeFocused:!0})},n.handleBlurCountryCode=function(){n.setState({isCountryCodeFocused:!1})},n.renderHelperText=function(){var e=n.props.inputHelperText,t=n.state,a=t.sendStatus,o=t.currentFormType;if(!e)return null;var i=o===h.SMS?"phone":"email";return r.default.createElement("div",{className:"send-app-link-form__"+i+"-input__error-text send-app-link-form__"+i+"-input__error-text--"+a},e)},n.getPhoneInput=function(){var e=n.props,t=e.phoneInputData,a=e.buttonPosition,o=e.inputHasBorder,i=e.isFullWidth,s=n.state,l=s.countryAbbreviation,m=s.isCountryCodeFocused,d=s.sendStatus,c=s.phoneNumber,_=u.format(n.getCountryIso(),c),f=n.getPhoneNumberPlaceholder();return t?r.default.createElement("div",{className:"\n        send-app-link-form__phone-input\n        send-app-link-form__phone-input--"+a+"\n        send-app-link-form__phone-input--"+(i?"full-width":"auto-width")+"\n        send-app-link-form__phone-input--"+d+"\n      "},r.default.createElement("div",{className:"send-app-link-form__phone-input__input-group"},r.default.createElement("div",{className:"send-app-link-form__country-select"},r.default.createElement("label",{htmlFor:"send-app-link-form__country-select__input"},p._("Country")),r.default.createElement("select",{id:"send-app-link-form__country-select__input",name:"country",className:"send-app-link-form__country-select__input",onChange:n.handleCountryCodeInput,onFocus:n.handleFocusCountryCode,onBlur:n.handleBlurCountryCode,ref:n.setCountrySelectRef,value:l},r.default.createElement("option",{disabled:!0,"aria-selected":!1},p._("Country code")),t.country_list.map((function(e){var t=e[0],a=e[1],o=n.getCountryCode(t);return o&&-1===S.indexOf(t)?r.default.createElement("option",{value:t,key:t,"aria-selected":l===t},a+" "+o):null}))),r.default.createElement("div",{className:"\n                send-app-link-form__country-select__display\n                send-app-link-form__country-select__display--"+d+"\n                send-app-link-form__country-select__display--"+(o?"border":"borderless")+"\n                send-app-link-form__country-select__display--"+(m?"outline":"no-outline")+"\n              ","aria-hidden":!0},n.getCountryCode())),r.default.createElement("div",{className:"send-app-link-form__phone-number"},r.default.createElement("label",{htmlFor:"send-app-link-form__phone-number__input"},p._("Phone number")),r.default.createElement("input",{id:"send-app-link-form__phone-number__input",type:"tel",name:"phone_number",className:"\n                send-app-link-form__phone-number__input\n                send-app-link-form__phone-number__input--"+d+"\n                send-app-link-form__phone-number__input--"+(o?"border":"borderless")+"\n              ",placeholder:p._("Phone number"),value:_,onChange:n.handlePhoneNumberInput,ref:n.setPhoneNumberInputRef,maxLength:f.length}),n.getStateIconElement())),n.renderHelperText()):null},n.setEmailInputRef=function(e){return n.emailInput=e},n.handleEmailInput=function(){n.emailInput&&n.setState({email:n.emailInput.value})},n.getEmailInput=function(){var e=n.state,t=e.sendStatus,a=e.email,o=n.props,i=o.buttonPosition,u=o.inputHasBorder,s=o.isFullWidth;return r.default.createElement("div",{className:"\n        send-app-link-form__email-input\n        send-app-link-form__email-input--"+i+"\n        send-app-link-form__email-input--"+(s?"full-width":"auto-width")+"\n        send-app-link-form__email-input--"+t+"\n      "},r.default.createElement("div",{className:"send-app-link-form__email-input__input-group"},r.default.createElement("label",{htmlFor:"send-app-link-form__email__input"},p._("Email address")),r.default.createElement("input",{id:"send-app-link-form__email__input",type:"email",name:"email",className:"\n              send-app-link-form__email__input\n              send-app-link-form__email__input--"+t+"\n              send-app-link-form__email__input--"+(u?"border":"borderless")+"\n            ",placeholder:p._("Email address"),value:a,onChange:n.handleEmailInput,ref:n.setEmailInputRef}),n.getStateIconElement()),n.renderHelperText())},n.getInactiveFormType=function(){var e=n.props.formTypes.filter((function(e){return e!==n.state.currentFormType}));return e.length?e[0]:null},n.getFormInputElement=function(){switch(n.state.currentFormType){case h.SMS:return n.getPhoneInput();case h.EMAIL:return n.getEmailInput();default:return null}},n.getFormSwitchPhrase=function(){switch(n.getInactiveFormType()){case h.SMS:return p._("Or text me the link");case h.EMAIL:return p._("Or email me the link");default:return null}},n.handleClickFormSwitch=function(e){e.preventDefault();var t=n.getInactiveFormType();t&&n.setState({currentFormType:t})},n.setFormRef=function(e){n.formRef=e},t.formTypes.includes(h.SMS)&&!t.phoneInputData)throw new Error("SMS form type required phoneInputData prop");return n.state={currentFormType:t.formTypes[0],phoneNumber:"",countryAbbreviation:s.LOCALE||"US",isCountryCodeFocused:!1,email:"",sendStatus:null},n}return n.__extends(t,e),t.prototype.componentDidUpdate=function(e,t){var n=this.props,r=n.onStatusChange,o=n.onSwitchFormType,i=n.onChangeCountryCode,u=this.state,l=u.sendStatus,p=u.phoneNumber,m=u.countryAbbreviation,d=u.currentFormType,c=u.email;if(r&&t.sendStatus!==l&&r({currentFormType:d,sendStatus:l,phoneNumber:p,email:c}),t.phoneNumber===p&&t.countryAbbreviation===m&&t.email===c&&t.currentFormType===d||(this.setState({sendStatus:null}),i&&m!==t.countryAbbreviation&&i(m),this.props.onChangeInput&&(t.email!==c?this.props.onChangeInput(c):t.phoneNumber!==p&&this.props.onChangeInput(p))),t.currentFormType!==d){if(this.setState({phoneNumber:"",countryAbbreviation:s.LOCALE||"US",email:""}),this.formRef){var f=a.findDOMNode(this.formRef),h=_.getTabbableElementsIn(f);h.length&&h[0].focus()}o&&o(d)}},t.prototype.render=function(){var e=this.props,t=e.SubmitButton,n=e.formTypes,a=e.buttonPosition,o=e.isFullWidth,i=e.showDisclaimer,u=this.state,s=u.sendStatus,l=u.currentFormType,p=this.getFormSwitchPhrase();return r.default.createElement("form",{noValidate:!0,onSubmit:this.handleSubmit,className:"\n          send-app-link-form\n          send-app-link-form--"+a+"\n        ",ref:this.setFormRef},this.getFormInputElement(),r.default.createElement("div",{className:"\n          send-app-link-form__submit-wrapper\n          send-app-link-form__submit-wrapper--"+(o?"full-width":"auto-width")+"\n        "},r.default.createElement(t,{sendStatus:s,currentFormType:l})),n.length>1&&p&&r.default.createElement("div",{className:"\n                send-app-link-form__form-switch__wrapper\n                send-app-link-form__form-switch__wrapper--"+(o?"full-width":"auto-width")+"\n              "},r.default.createElement("button",{className:"send-app-link-form__form-switch",onClick:this.handleClickFormSwitch},p)),i&&r.default.createElement("div",{className:"\n              send-app-link-form__disclaimer\n              send-app-link-form__disclaimer--"+(l===h.SMS?"visible":"hidden")+"\n            ","aria-hidden":l!==h.SMS},r.default.createElement(d.SendAppLinkFormDisclaimer,{tabIndex:l===h.SMS?0:-1,onShowTooltip:this.props.onShowDisclaimerTooltip})))},t})(r.default.Component);t.SendAppLinkFormComponent=b,t.SendAppLinkForm=o.requireCssWithComponent(b,["/static/css/growth/send_app_link_form-vflzIWydE.css"])}));
//# sourceMappingURL=send_app_link_form.min.js-vflgLQve9.map