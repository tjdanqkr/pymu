define(["require","exports","tslib","redux-actions","external/lodash","redux-saga","rondo/v1/behavior/types","rondo/v1/behavior/internal_actions","rondo/v1/action_listener_middleware","rondo/v1/metadata_redux","rondo/v1/metadata_redux_saga","rondo/v1/metadata_action_listener","rondo/v1/metadata_reselect","rondo/v1/slice_actions","rondo/v1/slice_selectors","rondo/v1/behavior/compose/path","rondo/v1/performance","rondo/v1/metadata","rondo/v1/invariant","rondo/v1/selectors","rondo/v1/behavior/compose/compose_behavior","rondo/v1/actions/types","rondo/v1/behavior/handle","rondo/v1/behavior/initial_state","rondo/v1/behavior/action_watcher","rondo/v1/behavior/subscribers","rondo/v1/behavior/utils"],(function(t,e,i,r,o,n,a,s,c,h,p,d,u,l,f,v,_,y,g,E,m,b,S,A,O,B,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o=i.__importStar(o),n=i.__importDefault(n);e.behavior=function(t){return(function(e){function T(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var s=e.apply(this,i.__spread(r))||this;s.__type__=a.BEHAVIOR_FIELD_TYPE,s._path=[],s._registerCount=0,s._createErrorHandles=function(){s.actionHandlers=s.actionHandlers||[],h.getHandleActionErrorEntries(t.prototype).forEach((function(t){t.element=t.element.bind(s),t.value.actions.forEach((function(e){return s.actionHandlers.push(new S.HandleAction(t.element,e.actionType,!0,e.useSlice,s,s))}))}))},s._createHandles=function(){s.actionHandlers=s.actionHandlers||[],h.getHandleActionEntries(t.prototype).forEach((function(t){t.element=t.element.bind(s),t.value.actions.forEach((function(e){return s.actionHandlers.push(new S.HandleAction(t.element,e.actionType,!1,e.useSlice,s,s))}))}))},s._createActionWatchers=function(){s.actionWatchers=s.actionWatchers||[],d.getWatchActionEntries(t.prototype).forEach((function(t){t.value.actions.forEach((function(e){return s.actionWatchers.push(new O.ActionWatcher(t.element,e.actionType,e.useSlice,s,s))}))}))},s.getState=function(){return g.invariant(!!s._getState,"Trying to access "+s.id+" state before store is set"),s.path.length>0?o.get(s._getState(),s.path):s._getState()},s.getFullState=function(){return g.invariant(!!s._getState,"Trying to access "+s.id+" state before store is set"),s._getState()},s.collectReducers=function(t){var e;if(t!==s){if(t.isRegistered)return;(e=s.actionHandlers).push.apply(e,i.__spread(t.actionHandlers||[]))}t.composedBehaviors&&t.composedBehaviors.forEach(s.collectReducers)},s.collectInitialStates=function(t){var e;if(t!==s){if(t.isRegistered)return;(e=s.initialStates).push.apply(e,i.__spread(t.initialStates||[]))}t.composedBehaviors&&t.composedBehaviors.forEach(s.collectInitialStates)},s.collectAction=function(t,e){return void 0===e&&(e={}),y.entriesOfTypeField(s,b.ACTION_FIELD_TYPE).forEach((function(t){var i=t.key,r=t.field;return o.set(e,s.path.concat(i),r)})),t.composedBehaviors&&t.composedBehaviors.forEach((function(t){return t.collectAction(t,e)})),e},s.collectActionWatcher=function(t){var e;if(t!==s){if(t.isRegistered)return;(e=s.actionWatchers).push.apply(e,i.__spread(t.actionWatchers||[]))}t.composedBehaviors&&t.composedBehaviors.forEach(s.collectActionWatcher)},s.collectSaga=function(t){var e,r;if(t!==s){if(t.isRegistered)return;(e=s.sagas).push.apply(e,i.__spread(t.sagas||[]))}(r=s.sagas).push.apply(r,i.__spread((t.sagaHandlers||[]).map((function(t){return t.create()})))),t.composedBehaviors&&t.composedBehaviors.forEach(s.collectSaga)};var c=r.length>0?r[0]:void 0,p=r.length>1?r[1]:void 0;return s.bindMethodsToObject(),s.id=s._generateUniqueId(),s.slice=c,s.sagaTasks=[],s.context=p,s.init(),s}return i.__extends(T,e),T.prototype.ctrKeys=function(){return Object.keys(t.prototype).concat(Object.keys(this))},T.prototype.extendBehavior=function(t){var e=this;t.slice||t.__notExtendWithSlice||(y.entriesOfTypeField(t,b.ACTION_FIELD_TYPE).forEach((function(i){var r=i.key;i.field;e.hasOwnProperty(r)||Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),y.entriesOfTypeField(t,E.SELECTOR_FIELD_TYPE).forEach((function(i){var r=i.key;i.field;e.hasOwnProperty(r)||Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),y.entriesOfTypeField(t,a.BEHAVIOR_FIELD_TYPE).forEach((function(i){var r=i.key;Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r)),e._ignoreCompose=(e._ignoreCompose||[]).concat(r)})))},T.prototype.init=function(){var e=this;y.entriesOfTypeField(this,a.BEHAVIOR_FIELD_TYPE,this.ctrKeys()).forEach((function(t){var i=t.key,r=t.field;(!e._ignoreCompose||e._ignoreCompose.indexOf(i)<0)&&m.composeBehavior(e,r,r.__notExtendWithSlice?void 0:r.slice||i)})),this.actions=h.createActions(t.prototype,this,this.actions),this._createHandles(),this._createErrorHandles(),this._createActionWatchers(),this.initialStates=this.initialStates||[],this.initialState&&this.initialStates.push(new A.InitialState(this.initialState,this)),this.selectors=u.createReselectors(t.prototype,this),this.sagas=p.getSagas(t.prototype).map((function(t){return t.bind(e)})),h.createActionCreators(t.prototype,this.path,this),y.entriesOfTypeField(this,b.ACTION_FIELD_TYPE).forEach((function(t){var i=t.key;return t.field.init(e,y.camelCaseToUnderscorePattern(i))})),y.entriesOfTypeField(this,E.SELECTOR_FIELD_TYPE).forEach((function(t){var i=t.key,r=t.field;r.init(e),e.selectors[i]=r})),this.pendingComposedBehaviors&&this.pendingComposedBehaviors.length>0&&m.composeBehaviors(this.pendingComposedBehaviors.splice(0))(this),this._initBehaviorReducer()},T.prototype.bindMethodsToObject=function(){var e,r;try{for(var n=i.__values(Object.getOwnPropertyNames(t.prototype)),a=n.next();!a.done;a=n.next()){var s=a.value,c=this[s];o.isFunction(c)&&"constructor"!==s&&(this[s]=c.bind(this))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},T.prototype.addBehavior=function(t){(this.pendingComposedBehaviors=this.pendingComposedBehaviors||[]).push(t),this.extendBehavior(t)},T.prototype.addUnsubscribers=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this.unsubscribers=this.unsubscribers||[]).push.apply(t,i.__spread(e))},Object.defineProperty(T.prototype,"_displayName",{get:function(){return this.constructor.displayName},enumerable:!0,configurable:!0}),T.prototype._generateUniqueId=function(){return"BEHAVIOR-"+(this._displayName?this._displayName+"-":"")+(this.slice?this.slice+"-":"")+Math.random().toString(36).substr(2,9)},T.prototype._initBehaviorReducer=function(){var t=this;this._attachReducer(s.actionInitBehavior(this.id),(function(e,i){var r=A.mergeInitialState(t.initialStates,t.path);return r?o.assignIn({},r,e):e}))},T.prototype._attachReducer=function(t,e){this.actionHandlers=this.actionHandlers||[],this.actionHandlers.push(new S.HandleAction(e,t,!1,!1,this,this))},Object.defineProperty(T.prototype,"path",{get:function(){return this._path?this._path.concat(this.slice||[]):[]},set:function(e){this._path=e,this.composedBehaviors&&v.setComposePath(this.composedBehaviors,this.path),h.createActionCreators(t.prototype,this.path,this)},enumerable:!0,configurable:!0}),T.prototype.pathState=function(t){return this.path.length>0?o.get(t,this.path):t},Object.defineProperty(T.prototype,"context",{get:function(){return this._context},set:function(t){this._context=t,this.composedBehaviors&&this.composedBehaviors.forEach((function(e){return e.context=t}))},enumerable:!0,configurable:!0}),T.prototype.createActions=function(){var t=l.createActions(this.actions,this.path);return this.collectAction(this,t),t},T.prototype.createWatchers=function(t){var e=t.get(a.ACTION_LISTENERS_MIDDLEWARE);e||(e=c.ActionListenerMiddleware(),t.register({name:a.ACTION_LISTENERS_MIDDLEWARE,middleware:e,order:0})),this.collectActionWatcher(this),this.addUnsubscribers.apply(this,i.__spread(this.actionWatchers.map((function(t){return t.create(e)}))))},T.prototype.middlewares=function(t){this.isRegistered||(this.createWatchers(t),this.createSagaMiddleware(t))},T.prototype.createSagaMiddleware=function(t){var e=t.get(a.SAGA_MIDDLEWARE);e||(e=n.default(),t.register({name:a.SAGA_MIDDLEWARE,middleware:e,order:0}))},T.prototype.postStoreCreation=function(e,i){var r=this;if(this.store=e,this.dispatch=e.dispatch,this._getState=e.getState,y.entriesOfTypeField(this,B.STATE_SUBSCRIBER_FIELD_TYPE).forEach((function(t){t.key;var i=t.field;i.behavior=r,i.store=e})),this.composedBehaviors&&this.composedBehaviors.forEach((function(t){t.postStoreCreation(e)})),i){var o=i.get(a.SAGA_MIDDLEWARE);o&&!this.isRegistered&&(this.collectSaga(this),this.sagas.forEach((function(t){return r.sagaTasks.push(o.run(t))})))}if(t.prototype.hasOwnProperty("ready")){var n=e.getState();this.ready(this.pathState(n),n)}},T.prototype.createReducer=function(){this.collectInitialStates(this),this.collectReducers(this);var t=A.mergeInitialState(this.initialStates,this.path);if(0===this.actionHandlers.length)return function(e){return void 0===e&&(e=t),e};var e=S.mergeHandles(this.actionHandlers);return r.handleActions(e,t)},T.prototype.createSelectors=function(){var t=this;return f.select(this.selectors,(function(e){return t.slice?e[t.slice]:e}))},Object.defineProperty(T.prototype,"isRegistered",{get:function(){return this._registerCount>0},enumerable:!0,configurable:!0}),T.prototype.register=function(){return this._registerCount++,(this.composedBehaviors||[]).forEach((function(t){return t.register()})),this._registerCount},T.prototype.unregister=function(t){return void 0===t&&(t=!1),this._registerCount--,(this.composedBehaviors||[]).forEach((function(t){return t.unregister(!0)})),this.isRegistered||(this.unsubscribers&&this.unsubscribers.length>0&&this.unsubscribers.splice(0).forEach((function(t){return t()})),t&&(this.actionWatchers=[],this.sagaHandlers=[],this.sagas=[]),this.sagaTasks.forEach((function(t){return t.cancel()})),this.sagaTasks=[],this.dispatch=void 0,this.store=void 0,this._getState=void 0),this._registerCount},T.__type__=a.BEHAVIOR_CLASS_FIELD_TYPE,T.displayName=(function(t){return t.hasOwnProperty("displayName")})(t)?t.displayName:(function(t){return t.hasOwnProperty("name")})(t)?t.name:"Behavior-"+Math.random().toString(36).substr(2,9),i.__decorate([_.markAroundDecorator("init")],T.prototype,"init",null),T})(t)},e.createBehavior=function(t,i){var r=new(T.isBehaviorClass(t)?t:e.behavior(t))("string"==typeof i?i:void 0);return Array.isArray(i)&&(r.path=i),r},e.extendBehavior=function(t,i){T.isBehavior(i)||(i=e.createBehavior(i)),t.addBehavior(i)}}));
//# sourceMappingURL=behavior.min.js-vflfrqP4w.map