define(["require","exports","tslib","modules/clean/ajax","modules/clean/api_v2/user_client","modules/core/browser","modules/core/browser_detection","modules/clean/sharing/api/client","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/viewer","modules/clean/react/paper/paper_log","modules/core/i18n","external/lodash","modules/clean/react/bubble_dropdown_v2","modules/core/notify","modules/clean/react/sign_in/utils","modules/clean/react/size_class/utils"],(function(e,n,r,t,o,i,a,s,l,c,u,p,d,_,f,m,b,h){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),t=r.__importStar(t),i=r.__importStar(i),l=r.__importStar(l),_=r.__importStar(_);var P,g=["VARIANT_A","VARIANT_B1","VARIANT_B2","VARIANT_B3","VARIANT_B4","ON"],T=["BUTTON","DROPDOWN","ELLIPSIS"],k=["docx"],x=["jpg","jpeg","png","pdf","xls","xlsx","mp4","mov","pptx","ppt","zip","rar","mp3"];function v(e){var n=e.file,r=e.user,t=e.sharedLink;return!!n&&((w(n)&&g.includes(l.OPEN_IN_PAPER_VARIANT)||A(n)&&T.includes(l.EMBED_TO_PAPER_VARIANT))&&!u.Viewer.get_viewer().is_assume_user_session&&!a.is_mobile_or_tablet()&&!a.msie&&(!r&&!!t||!!r&&!r.is_paper_disabled))}function A(e){var n=c.getExtension(e);return!!n&&x.includes(n)}function w(e){var n=c.getExtension(e);return!!n&&(k.includes(n)&&e.bytes<20971520)}function C(e){var n=e.file,r=e.sharedLink,o=e.contUrl,i=e.successCallback,a=e.errorCallback,s=e.extension,l=e._tk,c=e.oqa,u=e.fromModal;t.WebRequest({url:"/paper/sign_request_data",data:{path:n.file_id,sharedLink:r,cont_url:o,extension:s,_tk:l,oqa:c,fromModal:u},success:i,error:a})}(function(e){e[e.Off=1]="Off",e[e.Control=2]="Control",e[e.Button=3]="Button",e[e.Dropdown=4]="Dropdown",e[e.Ellipsis=5]="Ellipsis"})(P=n.OpenInPaperButtonVariant||(n.OpenInPaperButtonVariant={})),n.fileSizeWithinExperimentLimits=function(e,n){var r=51200;return"CONTROL"===n?r=20971520:"ONE_HUNDRED_KB"===n?r=102400:"FIFTY_KB"===n&&(r=51200),e.bytes<=r},n.getOpenInPaperButtonVariant=function(e){var n=e.file,r=e.sharedLink;return v(e)?w(n)?r?P.Button:P.Dropdown:P.Ellipsis:P.Off},n.getCalloutPosition=function(e){return e===P.Dropdown||e===P.Ellipsis?f.BubbleDropdownPositions.BOTTOM_LEFT:f.BubbleDropdownPositions.BOTTOM},n.shouldShowOpenInPaper=v,n.fileSupportsEmbedToPaper=A,n.fileSupportsCopyToPaper=w,n.getCTAText=function(e){var n=d._("Copy to Paper");return A(e)&&(n=d._("Add to Paper doc")),n},n.getCTATextDescription=function(e){return d._("Collect ideas and connect all kinds of files in a single doc.")},n.shouldShowCTADescription=function(e,n){return!h.isSmallerThanLarge(n)&&A(e)},n.getCalloutTitle=function(e){return A(e)?d._("Bring it all together"):d._("Bring this doc to life")},n.getCalloutMessage=function(e){return A(e)?d._("Add this file to a Paper doc to collect ideas and organize your thoughts."):d._("Copy to Paper and make changes or ask for feedback.")},n.createPaperAccountAndRedirect=C,n.openFileInPaper=function(e){var n=e.file,r=e.user,t=e.fromModal;if(r){var o=window.open("","_blank"),a=function(){o&&o.close(),m.Notify.error(d._("Canâ€™t copy file to Paper"))},l=e.sharedLink?e.sharedLink:"",u=e.sharedLink?"shared_file_actions":"mounted_file_actions",_=c.getExtension(n);p.paperLog(p.PaperEventTypes.CTA_CLICK,{source:u,cta:"open_in_paper_button",extension:_});var f={file:n,sharedLink:l,contUrl:"/create-doc-from-dropbox-file",extension:_,successCallback:function(e){o?i.redirect(e,o):i.redirect(e)},errorCallback:a,_tk:"dropbox_web_copy_from_previews",oqa:_,fromModal:t};if(w(n))C(f);else if(f._tk="dropbox_web_embed_from_previews",!l&&r){var h=new s.FileShareApiClient({userId:r.id});h.sharedLinkInfo({fileIdOrPath:n.file_id}).then((function(e){var r=e[0];r?(f.sharedLink=r.url,f.contUrl="/dropbox-file-embed",C(f)):h.createSharedLink({fileIdOrPath:n.file_id}).then((function(e){f.sharedLink=e.url,f.contUrl="/dropbox-file-embed",C(f)})).catch((function(e){a&&a()}))})).catch((function(e){a&&a()}))}else f.contUrl="/dropbox-file-embed",C(f)}else i.redirect(b.getSignInAndContinueUrl())};var I=_.once((function(){return new o.UserApiV2Client}));n.getPaperExperimentsPostTTI=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(n){return[2,I().ns("paper_post_tti").rpc("paper_experiments",{},{subjectUserId:e.id}).then((function(e){return e.experiments}))]}))}))},n.convertProtoEncryptionOptionsToProp=function(e){if(e)return{key:e.key,version:Number(e.version),type:e.type,timestamp:e.timestamp,plaintextFallback:e.plaintextFallback}}}));
//# sourceMappingURL=utils.min.js-vfl1B4Tf8.map