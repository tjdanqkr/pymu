define("modules/clean/search/logger",["require","exports","tslib","modules/clean/analytics","modules/clean/search/api_helpers","modules/clean/react/browse/logger_util"],(function(e,t,r,s,a,o){"use strict";var n;function i(e,t){var s=e;return r.__assign(r.__assign({},t),{file_nsid:s.ns_id,file_sjid:s.sjid,match_type:s.match_type||void 0})}Object.defineProperty(t,"__esModule",{value:!0}),(function(e){e.SHARED_DOC="shared_doc",e.SHARED_CLOUD_DOC="shared_cloud_doc"})(n=t.SearchLogResultType||(t.SearchLogResultType={})),t.logSearchAction=function(e){var t=e.searchSessionId,i=e.result,c=e.user,l=e.action_type,u=e.search_type,p=e.viewport,h=void 0===p?"full-view":p,d=e.view_type,_=e.action_surface,m=a.getCurrentTimezoneOffset(),f={viewport:h,action_type:l,search_type:u,search_session_id:t,view_type:d,position:i.sort_rank,request_id:i.request_id,timezone_offset:m};if(o.isFile(i)){var S=i;f=r.__assign(r.__assign({},f),{file_nsid:S.ns_id,file_sjid:S.sjid,match_type:S.match_type})}else if(o.isPaper(i)){var g=i;f=r.__assign(r.__assign({},f),{paper_pad_id:g.pad_id})}else if(o.isPaperFolder(i)){var y=i;f=r.__assign(r.__assign({},f),{paper_folder_id:y.folder_id})}else{var v=(S=i).is_cloud_doc?n.SHARED_CLOUD_DOC:n.SHARED_DOC;f=r.__assign(r.__assign({},f),{match_type:S.match_type,file_id:S.file_id,extra:{result_type:v}})}_&&(f.extra=r.__assign(r.__assign({},f.extra),{action_surface:_})),s.SearchClientActivityLogger.log("result_action",c.id,f)},t.logRecentHistoryDisplayed=function(e){var t=e.searchSessionId,r=e.user,o=e.history,n=a.getCurrentTimezoneOffset(),i=o.map((function(e){return e.rawQuery})).reduce((function(e,t,r){return e[r]=t,e}),{}),c={search_session_id:t,recent_history_map:JSON.stringify(i),timezone_offset:n,viewport:"dropdown-view"};s.SearchClientActivityLogger.log("recent_history_displayed",r.id,c)},t.logRecentHistoryCleared=function(e){var t=e.searchSessionId,r=e.user,o={search_session_id:t,timezone_offset:a.getCurrentTimezoneOffset(),viewport:"dropdown-view"};s.SearchClientActivityLogger.log("recent_history_cleared",r.id,o)},t.logRecentQuerySelected=function(e){var t=e.searchSessionId,r=e.query,o=e.user,n=e.rank,i=e.action_type,c=a.getCurrentTimezoneOffset(),l={search_session_id:t,query_string:r.rawQuery,position:n,timezone_offset:c,viewport:"dropdown-view",action_type:i};s.SearchClientActivityLogger.log("recent_query_selected",o.id,l)},t.logRecentQueryStored=function(e){var t=e.searchSessionId,r=e.requestId,o=e.query,n=e.user,i=e.previousPosition,c=e.viewport,l=void 0===c?"dropdown-view":c,u=a.getCurrentTimezoneOffset(),p={search_session_id:t,request_id:r,query_string:o.rawQuery,position:i,timezone_offset:u,viewport:l};s.SearchClientActivityLogger.log("recent_query_stored",n.id,p)},t.logScopeChipChanged=function(e){var t=e.searchSessionId,r=e.user,o=e.chipAdded,n=e.filePath,i=e.searchType,c=e.viewport,l={search_session_id:t,timezone_offset:a.getCurrentTimezoneOffset(),path_scoped:o,file_path:n,viewport:c,search_type:i};s.SearchClientActivityLogger.log("scope_chip_changed",r.id,l)},t.logSearchBarFocusLost=function(e){var t=e.searchSessionId,r=e.user,o={search_session_id:t,timezone_offset:a.getCurrentTimezoneOffset()};s.SearchClientActivityLogger.log("search_bar_focus_lost",r.id,o)},t.logHoverPreviewStarted=function(e){var t=e.searchSessionId,r=e.result,o=e.user,n=e.previewRequestId,c=e.viewport,l=void 0===c?"dropdown-view":c,u={search_session_id:t,preview_request_id:n,timezone_offset:a.getCurrentTimezoneOffset(),viewport:l};s.SearchClientActivityLogger.log("preview_started",o.id,i(r,u))},t.logHoverPreviewCompleted=function(e){var t=e.searchSessionId,r=e.result,o=e.user,n=e.previewRequestId,c=e.viewport,l=void 0===c?"dropdown-view":c,u=e.latency,p=e.displayed,h={search_session_id:t,preview_request_id:n,timezone_offset:a.getCurrentTimezoneOffset(),viewport:l,latency:u,displayed:p?"true":"false"};s.SearchClientActivityLogger.log("preview_completed",o.id,i(r,h))},t.logHoverPreviewFailed=function(e){var t=e.searchSessionId,r=e.result,o=e.user,n=e.previewRequestId,c=e.viewport,l=void 0===c?"dropdown-view":c,u=e.failureType,p={search_session_id:t,preview_request_id:n,timezone_offset:a.getCurrentTimezoneOffset(),viewport:l,failure_type:u};s.SearchClientActivityLogger.log("preview_failed",o.id,i(r,p))},t.logSearchResultsSortOrderChange=function(e){var t=e.searchSessionId,r=e.user,a=e.action_type,o=e.search_type,n=e.sort_order,i=e.viewport,c={viewport:void 0===i?"full-view":i,action_type:a,search_type:o,search_session_id:t,view_type:e.view_type,extra:{sort_field:n.sortField,sort_direction:n.sortDirection}};s.SearchClientActivityLogger.log("sort_results",r.id,c)}})),define("modules/clean/search/search_bar/api",["require","exports","tslib","modules/clean/ajax","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/search/constants","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),o=r.__importStar(o),n=r.__importStar(n);var f=(function(e){function t(t){var r=this,s=this.constructor.prototype;return(r=e.call(this,t)||this).__proto__=s,r}return r.__extends(t,e),t})(Error);t.RequestAbortedError=f;var S=(function(){function e(){this._searchApiUrl="/search/dropdown_search",this._activeRequest=null}return e.prototype.getSearchApiUrl=function(){return this._searchApiUrl},e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype._extractSlimSearchResultsList=function(e){for(var t=[],r=0,s=e;r<s.length;r++){var a=s[r];switch(a.search_result_type){case l.SearchResultTypes.FILE:t.push(u.SlimFileSearchResult.fromServerObject(a));break;case l.SearchResultTypes.PAPER:t.push(c.Paper.fromServerObject(a));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(c.PaperFolder.fromServerObject(a))}}return t},e.prototype.loadSlimResults=function(e){var t=e.user,s=e.path,a=e.query,o=e.searchSessionId,n=e.webTimer,i=e.fileCategories,c=p.getCurrentTimezoneOffset(),l=i?h.fileCategoriesToString(i):"",u=r.__assign({query:a,fq_path:s,timezone_offset:c,search_session_id:o,include_shared_docs:!0},l&&{file_categories:l});return this._fetchSlimResults(u,t,o,n)},e.prototype.fetchAdditionalFileMetadata=function(e){var t=this,r=e.searchResults,a=e.user;return new Promise((function(e,o){var i=r.filter((function(e){return e instanceof u.SlimFileSearchResult})).map((function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]}));i.length>0?s.WebRequest({url:n.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(i),includes:JSON.stringify([n.HREF])},dataType:"json",subject_user:a,success:function(s,a,o){var n=s.file_results;e(t._mergeFullResultsIntoSlimResults(n,r))},error:function(e,t,r){o("abort"===r?new f:new Error(r))}}):e(r)}))},e.prototype.fetchFullSearchResult=function(e){var t=e.searchResult,r=e.user,s=e.onSuccess,a=e.onError;if(t instanceof u.SlimFileSearchResult){var o=d.searchResultForPath(_.getStoreForSearchBar().getState(),t.fq_path);o?s(o):this.fetchAdditionalFileMetadata({searchResults:[t],user:r}).then((function(e){if(e.length>0)s(e[0]);else if(a){var t=m._("There was a problem completing this request.");a(t)}})).catch((function(e){!a||e instanceof f||a(e.message)}))}else(t instanceof c.Paper||t instanceof c.PaperFolder)&&s(t)},e.prototype._mergeFullResultsIntoSlimResults=function(e,t){for(var s=[],a=function(t){if(t instanceof u.SlimFileSearchResult){var a=e.find((function(e){return e.search_result_type===l.SearchResultTypes.FILE&&o.paths_are_equal(e.fq_path,t.fq_path)}));a&&s.push(c.File.fromServerObject(r.__assign(r.__assign({},t),a)))}else(t instanceof c.Paper||t instanceof c.PaperFolder)&&s.push(t)},n=0,i=t;n<i.length;n++){a(i[n])}return s},e.prototype._fetchSlimResults=function(e,t,r,a){var o=this;return new Promise((function(n,c){var l;null!=o._activeRequest&&o._activeRequest.abort();var p=h.fileCategoryStringToLogValue(e.file_categories),d={path_scoped:"/"!==e.fq_path,search_type:"dropdown",query_string:e.query,search_session_id:r,timezone_offset:e.timezone_offset,file_type_filters:p};i.SearchClientActivityLogger.log("query_started",t.id,d);var _=(new Date).getTime();o._activeRequest=s.WebRequest({url:o._searchApiUrl,data:e,dataType:"json",subject_user:t,success:function(s,c,l){for(var p=u.extractBrowseContext(s),h=s.search_results,m=l.getResponseHeader("x-dropbox-request-id"),f=0,S=0,g=h;S<g.length;S++){var y=g[S];y.request_id=m,y.sort_rank||0===y.sort_rank||(y.sort_rank=f++)}var v={results:o._extractSlimSearchResultsList(h),hasMore:!!s.more,nextPageOffset:+s.next_offset||0},E=i.SearchClientActivityLogger.create_search_log_dict(d,m,_,e.query,v.results.length,null,r);i.SearchClientActivityLogger.log("query_completed",t.id,E),a&&a.end(m||void 0),n({context:p,searchResults:v,deleted:!1})},error:function(s,o,n){l=s.getResponseHeader("x-dropbox-request-id");var u=i.SearchClientActivityLogger.create_search_log_dict(d,l,_,e.query,null,o,r);i.SearchClientActivityLogger.log("query_failed",t.id,u),a&&a.abort(),c("abort"===n?new f:new Error(n))},complete:function(){this._activeRequest=null}})}))},e})();t.SearchBarApiClient=S,t.searchBarApiClient=new S,t.getQuerySuggestions=function(e,t,r,s,o){var n=o?"search_experiment_query_suggestions:"+o:void 0;return(new a.UserApiV2Client).ns("files").rpc("get_query_suggestions",{query:t,max_results:r,search_session_id:s,variants:n},{subjectUserId:e})}})),define("modules/clean/search/search_bar/controller",["require","exports","tslib","react","external/lodash","react-redux","modules/clean/keycode","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/retrieval_success_banner/util","modules/clean/search/logger","modules/clean/search/search_bar/api","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/log_helper","modules/clean/search/search_bar/view","modules/clean/search/search_helpers","modules/clean/search/search_bar/chips","modules/clean/storage","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/core/notify","modules/clean/search/types","modules/clean/search/search_bar/experiments","modules/clean/react/css","modules/core/browser"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m,f,S,g,y,v,E,R,C,w,b,I,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),u=r.__importStar(u),h=r.__importStar(h),d=r.__importStar(d),S=r.__importStar(S),g=r.__importStar(g),E=r.__importStar(E),P=r.__importStar(P);var x=(function(e){function t(t){var s=e.call(this,t)||this;return s._searchBarWebTimer=null,s._selectFirstFile=a.noop,s._clearSelection=a.noop,s._logHistoryItemSelected=function(e,t,r){u.logRecentQuerySelected({searchSessionId:s.props.searchSessionId,query:e,user:s.props.user,rank:t-s.props.headerItems.length,action_type:r})},s._handleHistoryItemClick=function(e,t){s._logHistoryItemSelected(e,t),s._setSearchQuery(e.rawQuery)},s._handleRecentSearchContextMenuCapture=function(e,t){s._logHistoryItemSelected(e,t,R.WebUserActionLogEvent.CONTEXT_MENU)},s._handleInputChange=function(e){s._setSearchQuery(e)},s._handleCancelSearch=function(){s._setSearchQuery("")},s._handleScopeChipChange=function(e){u.logScopeChipChanged({searchSessionId:s.props.searchSessionId,user:s.props.user,chipAdded:e,searchType:"dropdown",filePath:e?s.props.browseScope:"/",viewport:s.props.isExpanded?"full-view":void 0}),e?s.props.setScopeChip({scopeChip:s.props.browseScope}):s.props.setScopeChip({}),s._setSearchQuery(s.props.rawQuery,!0)},s._onBrowseScopeChange=function(e){s.props.setScopeChip({scopeChip:g.isValidPathForChip(e)?e:void 0})},s._handleInputKeydown=function(e,t){if(e.keyCode!==n.KeyCode.ESC)if(e.keyCode!==n.KeyCode.BACKSPACE||0!==t||g.isScopeChipRoot(s.props.scopeChip)){if(e.stopPropagation(),b.isInSinglePageSearchExperiment(s.props.searchBarExperiments)){if(e.keyCode===n.KeyCode.DOWN&&s.props.rawQuery)return e.preventDefault(),void s._selectFirstFile();e.keyCode===n.KeyCode.TAB&&s.props.blurSearchBar()}e.keyCode===n.KeyCode.UP?(e.preventDefault(),s.props.highlightPreviousRow()):e.keyCode===n.KeyCode.DOWN&&(e.preventDefault(),s.props.highlightNextRow())}else s._handleScopeChipChange(!1);else s._handleCancelSearch()},s._handleSearch=function(e,t){var a=s.props.searchBarExperiments;a.expSearchSuccessBanner&&!b.isInSinglePageSearchExperiment(a)&&l.doSearchBarInteractionBroadcast(!1);var o=S.fileCategoriesToString(s.props.fileCategories);s.props.onSearch({query:e,searchToken:S.getSearchCsrfToken(),searchSessionId:s.props.searchSessionId,searchPath:t||s.props.scopeChip,qargs:r.__assign(r.__assign({},o&&{file_categories:o}),{search_order_by:c.getQueryArgs().search_order_by,search_reverse_order:c.getQueryArgs().search_reverse_order,search_type:c.getQueryArgs().search_type})})},s._navToSelection=function(e){var t=s.props.searchResults[e],r=s.props.slimSearchResults[e];t?(s._handleSlimSearchResultOpen(r),s._openSearchResult(t)):r&&s._handleSearchResultOpen(r)},s._handleInputSubmit=function(e,t){if(e.preventDefault(),!b.isInSinglePageSearchExperiment(s.props.searchBarExperiments)){var r=s.props.headerItems;if(t<r.length)switch(r[t]){case w.SearchBarDropdownHeaderItemType.SEARCH_ALL:s._handleSearch(s.props.normalizedQuery);break;case w.SearchBarDropdownHeaderItemType.SCOPE_CHIPS:var a=!g.isValidPathForChip(s.props.scopeChip);s._handleScopeChipChange(a)}else t-=r.length,s._navToSelection(t)}},s._handleContextMenuCapture=function(e){var t=s.props,r=t.user,a=t.searchSessionId;p.searchBarApiClient.fetchFullSearchResult({searchResult:e,user:r,onSuccess:function(e){s._dispatchSearchSuccessful(e.request_id||""),m.logDropdownSearchAction({result:e,user:r,action_type:e instanceof i.File?R.WebUserActionLogEvent.CONTEXT_MENU:R.WebUserActionLogEvent.PAPER_CONTEXT_MENU,viewport:"dropdown-view",searchSessionId:a})}})},s._handleSlimSearchResultOpen=function(e){var t=s.props,r=t.onSlimSearchResultOpen,a=t.searchBarExperiments.expSearchSuccessBanner;r&&(a&&"/h"===P.get_pathname()&&l.setSearchSuccessBannerVisibleFromHome(),r(e))},s._handleSearchResultOpen=function(e){var t=s.props,r=t.user;if(t.searchBarExperiments.expSearchSuccessBanner&&e&&e.fq_path&&(l.doSearchBarInteractionBroadcast(!1),l.doSearchResultActionClickBroadcast(!1),l.setSearchSuccessBannerVisible(),e.is_dir)){var a=e.fq_path;l.setFolderSearchResultData(a)}s._handleSlimSearchResultOpen(e),p.searchBarApiClient.fetchFullSearchResult({searchResult:e,user:r,onSuccess:function(e){s._openSearchResult(e)},onError:function(e){C.Notify.error(e)}})},s._handleResultObjectPathClick=function(e){s._dispatchSearchSuccessful(e.request_id||""),s.props.onResultObjectPathClick(e)},s._handleHighlightDropdownItem=function(e){s.props.setHighlightedRow({highlightedSearchRow:e})},s._handleSearchBarFocus=function(){var e=s.props,t=e.user,r=e.searchBarExperiments;b.isInSinglePageSearchExperiment(r)||s._setSearchQuery(s.props.normalizedQuery),r.expSearchSuccessBanner&&!b.isInSinglePageSearchExperiment(r)&&(l.resetSearchResultClickKey(),l.doSearchBarInteractionBroadcast(!1)),r.expBrowseSuccessBanner===w.BrowseSuccessBannerVariants.V1||r.expBrowseSuccessBanner===w.BrowseSuccessBannerVariants.V3?(l.clearBrowseSuccessBannerCounter(),l.clearBrowseSuccessBannerKey()):r.expBrowseSuccessBanner===w.BrowseSuccessBannerVariants.V2&&l.clearBSBExtraData(),s.props.focusSearchBar(),s.props.loadHistory({user:t}),b.isInSinglePageSearchExperiment(r)&&s._clearSelection()},s._handleSearchBarBlur=function(){var e=s.props,t=e.searchBarExperiments,r=e.searchBarLoading,a=e.slimSearchResults;!t.expSearchSuccessBanner||l.userIsOptedOutOfRetrievalSuccessBanner()||l.shouldShowSearchSuccessBanner()||r||!a.length||l.setSearchSuccessBannerVisible(),s.props.blurSearchBar()},s._dispatchSearchSuccessful=function(e){var t=s.props,r=t.user,a=t.rawQuery,o=t.normalizedQuery,n=t.searchSessionId;(0,t.addQueryToHistory)({user:r,query:{rawQuery:a,normalizedQuery:o},searchSessionId:n,requestId:e})},s._logSearchBarTTI=function(){s._searchBarWebTimer&&s._searchBarWebTimer.markTimeToInteractive()},s._handleHistoryClearAllClick=function(){var e=s.props,t=e.user;(0,e.clearAllHistory)({user:t})},t.setExperiments({experiments:t.searchBarExperiments}),s.props.setScopeChip({scopeChip:t.currentPath}),s}return r.__extends(t,e),t.prototype.componentWillMount=function(){var e=v.Viewer.get_viewer().get_users().map((function(e){return e.id}));y.UserLocalStorage.clearOtherUsers(e)},t.prototype.componentWillUnmount=function(){this._logFocusLost(this.props.isFocused,!1)},t.prototype.componentWillReceiveProps=function(e){this.props.currentPath!==e.currentPath&&this._onBrowseScopeChange(e.currentPath||t.defaultProps.currentPath),this.props.searchBarExperiments!==e.searchBarExperiments&&this.props.setExperiments({experiments:e.searchBarExperiments})},t.prototype.componentDidUpdate=function(e){this._logFocusLost(e.isFocused,this.props.isFocused),this.props.currentPath===e.currentPath&&S.fileCategoriesToString(this.props.fileCategories)===S.fileCategoriesToString(e.fileCategories)||this.props.invalidateResults()},t.prototype._logFocusLost=function(e,t){e&&!t&&u.logSearchBarFocusLost({user:this.props.user,searchSessionId:this.props.searchSessionId})},t.prototype._setSearchQuery=function(e,t){var r=this;void 0===t&&(t=!1);var s=this.props,a=s.user,o=s.setSearchQueryAndFetchResults,n=s.searchBarExperiments;o({user:a,query:e,webTimer:b.isInSinglePageSearchExperiment(n)?void 0:this._startSearchBarTimer(),keepHighlightedRow:t}),b.isInSinglePageSearchExperiment(n)&&setTimeout((function(){r._handleSearch(e)}))},t.prototype._openSearchResult=function(e){this._dispatchSearchSuccessful(e.request_id||""),this.props.onSearchResultOpen(e)},t.prototype._startSearchBarTimer=function(){return this._searchBarWebTimer?this._searchBarWebTimer.restart():(this._searchBarWebTimer=E.get_timer("search_bar"),this._searchBarWebTimer.initialize({requireTTI:!0,requireTTV:!1,url:p.searchBarApiClient.getSearchApiUrl()})),this._searchBarWebTimer},t.prototype.render=function(){var e=this.props,t=e.user,r=e.isExpanded,a=e.isFocused,o=e.isActive,n=e.rawQuery,i=e.normalizedQuery,c=e.slimSearchResults,l=e.searchBarLoading,u=e.searchSessionId,p=e.highlightedRow,h=e.searchHistory,d=e.scopeChip,_=e.searchPath,m=e.headerItems,S=e.searchBarExperiments,g=e.browseScope,y=e.placeholder;return s.default.createElement(f.SearchBarView,{user:t,isExpanded:!!r,searchBarExperiments:S,isFocused:a,isActive:o,inputTextValue:n,normalizedQuery:i,searchResults:c,searchBarLoading:l,searchSessionId:u,highlightedRow:p,searchHistory:h,scopeChip:d,browseScope:g,searchPath:_,dropdownHeaderItems:m,placeholder:y,onSearch:this._handleSearch,onHistoryClearAllClick:this._handleHistoryClearAllClick,onHistoryItemClick:this._handleHistoryItemClick,onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchResultOpen:this._handleSearchResultOpen,onContextMenuCapture:this._handleContextMenuCapture,onRecentSearchContextMenuCapture:this._handleRecentSearchContextMenuCapture,onResultObjectPathClick:this._handleResultObjectPathClick,onSearchBarFocus:this._handleSearchBarFocus,onSearchBarBlur:this._handleSearchBarBlur,onHighlightDropdownItem:this._handleHighlightDropdownItem,onSearchChipInteraction:this._handleScopeChipChange,onDropdownTTI:this._logSearchBarTTI})},t.defaultProps={currentPath:"/",isExpanded:!1},t})(s.default.PureComponent);t.SearchBarControllerElement=x;var T=_.getStoreForSearchBar(),A={blurSearchBar:h.blurSearchBar,focusSearchBar:h.focusSearchBar,loadHistory:h.loadHistory,highlightPreviousRow:h.highlightPreviousRow,highlightNextRow:h.highlightNextRow,setHighlightedRow:h.setHighlightedRow,addQueryToHistory:h.addQueryToHistory,setSearchQueryAndFetchResults:h.setSearchQueryAndFetchResults,clearAllHistory:h.clearAllHistory,setExperiments:h.setExperiments,setScopeChip:h.setScopeChip,invalidateResults:h.invalidateResults},B=o.connect((function(e){var t=d.isSearchBarFocused,r=d.isSearchBarActive,s=d.rawQuery,a=d.normalizedQuery,o=d.searchResults,n=d.slimSearchResults,i=d.isSearchBarLoading,c=d.searchSessionId,l=d.highlightedSearchRow,u=d.searchHistory,p=d.scopeChip,h=d.searchPath,_=d.headerItems,m=d.browseScope,f=d.fileCategories,S=d.resultsInvalid;return{isFocused:t(e),isActive:r(e),rawQuery:s(e),normalizedQuery:a(e),searchResults:o(e),slimSearchResults:n(e),searchBarLoading:i(e),searchSessionId:c(e),highlightedRow:l(e),searchHistory:u(e),scopeChip:p(e),searchPath:h(e),headerItems:_(e),browseScope:m(e),fileCategories:f(e),resultsInvalid:S(e)}}),A)(x);t.SearchBarController=I.requireCssWithComponent((function(e){return s.default.createElement(o.Provider,{store:T},s.default.createElement(B,r.__assign({},e)))}),["/static/css/search/search_bar_react-vflJnb6jY.css"])})),define("modules/clean/search/search_bar/data/action_creators",["require","exports","tslib","modules/clean/search/search_bar/api","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/types","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/history","modules/core/exception"],(function(e,t,r,s,a,o,n,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),i=r.__importStar(i),c=r.__importStar(c),t.focusSearchBar=function(){return{type:o.ActionTypes.FOCUS}},t.blurSearchBar=function(){return{type:o.ActionTypes.BLUR}},t.clearSearchBar=function(){return{type:o.ActionTypes.CLEAR}},t.updateHistoryInternal=function(e){var t=e.searchHistory;return{type:o.ActionTypes.UPDATE_HISTORY,payload:{searchHistory:t}}},t.loadHistory=function(e){var r=e.user;return function(e){var s=i.getHistory(r);e(t.updateHistoryInternal({searchHistory:s}))}},t.addQueryToHistory=function(e){var r=e.user,s=e.query,a=e.searchSessionId,o=e.requestId,n=e.skipLogging;return function(e){var c=i.addQuery(r,s,a,o,n);e(t.updateHistoryInternal({searchHistory:c}))}},t.clearAllHistory=function(e){var r=e.user,s=e.skipLogging;return function(e,o){var n=i.clearAll(r,a.searchSessionId(o()),s);e(t.updateHistoryInternal({searchHistory:n}))}},t.setSearchQuery=function(e){var t=e.query,r=e.searchSessionId,s=e.keepHighlightedRow,a=e.searchPath;return{type:o.ActionTypes.SET_QUERY,payload:{query:t,searchSessionId:r,keepHighlightedRow:s,searchPath:a}}},t.setSearchResults=function(e){var t=e.searchResults;return{type:o.ActionTypes.SET_SEARCH_RESULTS,payload:{searchResults:t}}},t.setSlimSearchResults=function(e){var t=e.slimSearchResults;return{type:o.ActionTypes.SET_SLIM_SEARCH_RESULTS,payload:{slimSearchResults:t}}},t.setHighlightedRow=function(e){var t=e.highlightedSearchRow;return{type:o.ActionTypes.SET_HIGHLIGHTED_ROW,payload:{highlightedSearchRow:t}}},t.highlightPreviousRow=function(){return{type:o.ActionTypes.HIGHLIGHT_PREVIOUS_ROW}},t.highlightNextRow=function(){return{type:o.ActionTypes.HIGHLIGHT_NEXT_ROW}},t.setBrowseScope=function(e){var t=e.browseScope;return{type:o.ActionTypes.SET_BROWSE_SCOPE,payload:{browseScope:t}}},t.setScopeChip=function(e){var t=e.scopeChip;return{type:o.ActionTypes.SET_SCOPE_CHIP,payload:{scopeChip:t}}},t.setFileCategories=function(e){var t=e.fileCategories;return{type:o.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:t}}},t.invalidateResults=function(){return{type:o.ActionTypes.INVALIDATE_RESULTS}},t.setSearchQueryAndFetchResults=function(o){var i=this,l=o.user,u=o.query,p=o.webTimer,h=o.searchSessionId,d=o.keepHighlightedRow;return function(o,_){return r.__awaiter(i,void 0,void 0,(function(){var i,m,f,S,g,y;return r.__generator(this,(function(v){switch(v.label){case 0:if(i=a.scopeChip(_()),(m=function(){return u===a.rawQuery(_())&&i===a.searchPath(_())})()&&!a.resultsInvalid(_()))return[2];if(o(t.setSearchQuery({query:u,searchPath:i,searchSessionId:h,keepHighlightedRow:d})),n.isInSinglePageSearchExperiment(a.experiments(_())))return o(t.setSearchResults({searchResults:{results:[],hasMore:!1}})),[2];if(!a.isSearchBarLoading(_()))return[3,9];v.label=1;case 1:return v.trys.push([1,8,,9]),[4,s.searchBarApiClient.loadSlimResults({user:l,path:i,query:a.normalizedQuery(_()),searchSessionId:a.searchSessionId(_()),webTimer:p,fileCategories:a.fileCategories(_())})];case 2:if(f=v.sent().searchResults,!m())return[2];v.label=3;case 3:return v.trys.push([3,5,,6]),[4,new Promise((function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)})).then(r.__importStar)];case 4:return(0,v.sent().checkForMissingStarredData)({items:f.results,user:l}),[3,6];case 5:return S=v.sent(),c.reportException({err:S,severity:c.SEVERITY.NONCRITICAL,tags:["search_bar"]}),[3,6];case 6:return o(t.setSlimSearchResults({slimSearchResults:f})),[4,s.searchBarApiClient.fetchAdditionalFileMetadata({searchResults:f.results,user:l})];case 7:return g=v.sent(),m()?(o(t.setSearchResults({searchResults:{results:g,hasMore:!1}})),[3,9]):[2];case 8:if(!((y=v.sent())instanceof s.RequestAbortedError))throw y;return[3,9];case 9:return[2]}}))}))}},t.setExperiments=function(e){var t=e.experiments;return{type:o.ActionTypes.SET_EXPERIMENTS,payload:{experiments:t}}}})),define("modules/clean/search/search_bar/history",["require","exports","tslib","external/lodash","modules/clean/search/constants","modules/clean/storage","modules/clean/search/logger"],(function(e,t,r,s,a,o,n){"use strict";function i(e){return o.UserLocalStorage.get(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[]}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),n=r.__importStar(n),t.getHistory=i;var c=function(e,t){return e.normalizedQuery===t.normalizedQuery};function l(e,t){return s.findIndex(e,(function(e){return c(e,t)}))}t.addQuery=function(e,t,s,u,p){void 0===s&&(s=""),void 0===u&&(u=""),void 0===p&&(p=!1);var h=i(e);if(!t.normalizedQuery.length)return h;if(!p){var d=l(h,t);n.logRecentQueryStored({searchSessionId:s,requestId:u,query:t,user:e,previousPosition:d})}return h=h.filter((function(e){return!c(e,t)})),h=r.__spreadArrays([t],h).slice(0,a.SEARCH_RECENT_HISTORY_CAPACITY),o.UserLocalStorage.set(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY,h),h},t.clearAll=function(e,t,r){void 0===t&&(t=""),void 0===r&&(r=!1),r||n.logRecentHistoryCleared({searchSessionId:t,user:e});var s=[];return o.UserLocalStorage.set(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY,s),s},t.getPreviousPosition=l,t.testMockSetup=function(){o.UserLocalStorage.clearOtherUsers([])},t.testMockTeardown=function(){o.UserLocalStorage.clearOtherUsers([])}})),define("modules/clean/search/search_bar/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors"],(function(e,t,r,s,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),o=r.__importStar(o),t.logDropdownSearchAction=function(e){var t=e.result,r=e.user,n=e.action_type,i=e.viewport,c=e.view_type,l=e.searchSessionId;s.logSearchAction({searchSessionId:l||o.searchSessionId(a.getStoreForSearchBar().getState()),result:t,user:r,action_type:n,search_type:"dropdown",viewport:i,view_type:c})}})),define("modules/clean/search/search_bar/view",["require","exports","tslib","classnames","react","spectrum/icon_content","spectrum/icon_global","modules/clean/em_string","modules/clean/filepath","modules/clean/keycode","modules/clean/react/title_bubble","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/search/types","modules/clean/web_timing_logger","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),c=r.__importStar(c),p=r.__importStar(p),_=r.__importStar(_);var f=(function(t){function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderDropdown=function(){},e._handleNavigation=function(){e._searchBarInput.blurSearchBarTextInput()},e._onHistoryItemClick=function(t,r){e.props.onHistoryItemClick&&e.props.onHistoryItemClick(t,r)},e._onSearchResultOpen=function(t){e.props.onSearchResultOpen(t),e._handleNavigation()},e._onResultObjectPathClick=function(t){e.props.onResultObjectPathClick(t),e._handleNavigation()},e._onSearch=function(t){var r=e.props.onSearch;r&&r(t),e._handleNavigation()},e._setSearchBarInputRef=function(t){return e._searchBarInput=t},e._setSearchBarDropdownRef=function(t){e._searchBarDropdown=t},e}return r.__extends(o,t),o.prototype.getSearchBarInput=function(){return this._searchBarInput},o.prototype.getSearchBarDropdown=function(){return this._searchBarDropdown},o.prototype._shouldRenderDropdown=function(){var e=this.props,t=e.searchHistory,r=e.normalizedQuery,s=e.dropdownHeaderItems;return!!(t&&t.length||s&&-1!==s.indexOf(d.SearchBarDropdownHeaderItemType.SCOPE_CHIPS)||r&&r.length)},o.prototype.componentDidMount=function(){var t=this;_.waitForTTI().then((function(){Promise.all([new Promise((function(t,r){e(["modules/clean/search/search_bar/dropdown"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)})).then(r.__importStar)]).then((function(e){var r=e[0].SearchBarDropdown,s=e[1];s.Star,s.HOME_RESOURCE_ID_TYPE,s.StarredSource,s.checkForMissingStarredData;t._renderDropdown=function(){var e=t.props,s=e.browseScope,o=e.children,n=e.dropdownHeaderItems,i=e.highlightedRow,c=e.isFocused,l=e.normalizedQuery,u=e.onContextMenuCapture,p=e.onDropdownTTI,h=e.onHighlightDropdownItem,d=e.onHistoryClearAllClick,_=e.onRecentSearchContextMenuCapture,m=e.onSearchChipInteraction,f=e.scopeChip,S=e.searchBarExperiments,g=e.searchBarLoading,y=e.searchHistory,v=e.searchPath,E=e.searchSessionId,R=e.showLinkToResultsPage,C=e.searchResults,w=e.user;return a.default.createElement(r,{browseScope:s,children:o,dropdownHeaderItems:n||[],highlightedRow:i,isOpen:c,normalizedQuery:l,onContextMenuCapture:u,onDropdownTTI:p,onHighlightDropdownItem:h,onHistoryClearAllClick:d,onHistoryItemClick:t._onHistoryItemClick,onRecentSearchContextMenuCapture:_,onResultObjectPathClick:t._onResultObjectPathClick,onSearch:t._onSearch,onSearchChipInteraction:m,onSearchResultOpen:t._onSearchResultOpen,ref:t._setSearchBarDropdownRef,scopeChip:f,searchBarExperiments:S,searchBarLoading:g,searchHistory:y||[],searchPath:v,searchSessionId:E,showLinkToResultsPage:R,searchResults:C,user:w})},t._shouldRenderDropdown()&&t.forceUpdate()}))}))},o.prototype.render=function(){var e=this.props,t=e.isActive,o=e.isExpanded,n=e.isFocused,i=e.searchBarExperiments,c={"search-bar--container":!0,"u-l-fr":!0,"sps--search-bar--container":h.isInSinglePageSearchExperiment(i),"is-expanded":o,"is-focused":n},l={"is-active":t,"is-collapsed":!(o||n),"is-expanded":o,"is-focused":n,"search-bar":!0},u=this._shouldRenderDropdown();return a.default.createElement("div",{className:s.default(c)},a.default.createElement("div",{className:s.default(l)},a.default.createElement(S,r.__assign({},this.props,{shouldRenderDropdown:u,ref:this._setSearchBarInputRef})),u&&this._renderDropdown()))},o.defaultProps={inputTextValue:"",normalizedQuery:"",showLinkToResultsPage:!0},o})(a.default.Component);t.SearchBarView=f;var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.focusSearchBarTextInput=function(){t.props.isFocused||t._searchBarTextInput.focus()},t._onKeyDown=function(e){var r=t.props,s=r.normalizedQuery,a=r.areQuerySuggestionsLoaded,o=s&&a;e.keyCode!==l.KeyCode.ESC||o||t.blurSearchBarTextInput(),t.props.onInputKeydown(e,t._getCursorPosition())},t._onSubmit=function(e){var r=t.props.highlightedRow,s=t.props.searchHistory||[],a=!t.props.normalizedQuery&&s.length>0,o=t.props.dropdownHeaderItems||[],n=r-o.length;if(a&&n>=0){e.preventDefault();var i=s[n];t.props.onHistoryItemClick&&t.props.onHistoryItemClick(i,n)}else{var c=t.props,l=c.normalizedQuery,u=c.areQuerySuggestionsLoaded,p=c.querySuggestions,h=c.onQuerySuggestionsClick,_=c.onQuerySuggestionsDismiss,m=r-1;if(!(l&&u&&p&&h&&_))return r<o.length&&o[r]===d.SearchBarDropdownHeaderItemType.SCOPE_CHIPS||t.blurSearchBarTextInput(),t.props.onInputSubmit(e,r);e.preventDefault(),m>=0?h(p[m],m):_(i=l||"")}},t._handleInputChange=function(e){t.props.onInputChange(e.currentTarget.value)},t._setSearchBarTextInputRef=function(e){return t._searchBarTextInput=e},t}return r.__extends(t,e),t.prototype._getCursorPosition=function(){return this._searchBarTextInput.selectionEnd},t.prototype.getSearchBarTextInput=function(){return this._searchBarTextInput},t.prototype.blurSearchBarTextInput=function(){this._searchBarTextInput.blur(),this.props.onSearchBarBlur()},t.prototype.render=function(){var e=this.props,t=e.onSearchBarFocus,s=e.onSearchBarBlur,o=e.isFocused,i=e.highlightedRow,c=e.inputTextValue,l=e.shouldRenderDropdown?{"aria-expanded":o,"aria-activedescendant":"search-dropdown-item"+i,"aria-autocomplete":"list","aria-owns":"search-bar__dropdown-items",role:"combobox"}:void 0,u=this.props.placeholder||m._("Search");return a.default.createElement("form",{className:"search-bar__input",onSubmit:this._onSubmit},a.default.createElement("span",{"aria-label":u,className:"search-bar__button","aria-hidden":"true"},a.default.createElement(n.IconGlobal,{name:"search-small"})),a.default.createElement(g,r.__assign({},this.props,{focusSearchInput:this.focusSearchBarTextInput})),a.default.createElement("input",r.__assign({"aria-label":u},l,{className:"search-bar__text-input",maxLength:1e3,onChange:this._handleInputChange,onFocus:t,onBlur:s,onKeyDown:this._onKeyDown,placeholder:u,ref:this._setSearchBarTextInputRef,value:c})))},t})(a.default.Component);t.SearchBarInput=S;var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onScopeChipClosed=function(){t.props.onSearchChipInteraction&&t.props.onSearchChipInteraction(!1)},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.scopeChip,r=e.user,s=e.isFocused,n=e.isExpanded;if(t&&p.isValidPathForChip(t)){var i=r.cdm_tmf_path&&t&&c.paths_are_equal(r.cdm_tmf_path,t)?"folder_team_member_child-small":"folder-small",l=c.child_dir(t);return a.default.createElement(y,{key:"scope",isFocused:s,isExpanded:n,icon:a.default.createElement(o.IconContent,{name:i,height:"18px",width:"18px"}),text:l,onClose:this._onScopeChipClosed,onClick:this.props.focusSearchInput})}return null},t})(a.default.Component),y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseDownOnChipItem=function(e){e.stopPropagation(),e.preventDefault()},t._onMouseDownClose=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClose()},t._onMouseDownOnChipButton=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClick()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.isFocused,r=e.isExpanded,s=e.text,o=e.icon;if(!s)return null;var n=i.Emstring.em_snippet(s,8,.6),c=a.default.createElement("span",{className:"search_bar__chip_text",key:"text"},n),l=n!==s;return r||t?a.default.createElement("span",{className:"search_bar__chip"},a.default.createElement("span",{className:"search_bar__chip_item",tabIndex:0,onMouseDown:this._onMouseDownOnChipItem,"data-chip":s},o,l?a.default.createElement(u.TitleBubble,{content:s,position:u.TitleBubble.POSITIONS.BOTTOM,key:"text"},c):c),a.default.createElement("button",{type:"button","aria-label":m._("Remove filter"),className:"search_bar__chip_close_button",key:"close",onMouseDown:this._onMouseDownClose})):a.default.createElement("span",{className:"search_bar__chip"},a.default.createElement("button",{type:"button","aria-label":m._("Search"),className:"search_bar__chip_button",onMouseDown:this._onMouseDownOnChipButton},o))},t})(a.default.PureComponent)})),define("modules/clean/search/single_page/constants",["require","exports","modules/clean/search/types","modules/core/i18n"],(function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SEARCH_QUERY_DEBOUNCE=50,t.SEARCH_FIRST_PAGE_SIZE=10,t.SEARCH_DROPDOWN_PAGE_SIZE=8,t.SEARCH_ADDITIONAL_PAGE_SIZE=50,t.SEARCH_SECOND_PAGE_DEBOUNCE=200,t.SEARCH_INPUT_ANIMATION_MS=200,t.SEARCH_URL_ROOT="/search",t.SEARCH_URL_REGEX=/^\/search\//,t.BROWSE_URL_REGEX=/^\/(home|personal|work)/,t.HOME_URL_REGEX=/^\/h([^\w]|$)/,t.SEARCH_HISTORY_DELAY=500,t.SEARCH_WEB_TIMER="single-page-search",t.SEARCH_TAB_HEIGHT=40,t.SEARCH_PAGE_HEADER_HEIGHT_DESKTOP=96,t.SEARCH_PAGE_HEADER_HEIGHT_TABLET=56,t.SEARCH_PAGE_HEADER_HEIGHT_MOBILE=80,t.SEARCH_SUCCESS_BANNER_HEIGHT=70,t.SEARCH_PRIOR_QUERY_SUGGESTIONS_CAPACITY=5,t.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY=3,t.FILE_CATEGORIES_PAPER=[{category:r.FileCategory.IMAGE,label:s._("Images"),tooltip:s._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},{category:r.FileCategory.DOCUMENT,label:s._("Documents"),tooltip:s._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"txt-small"},{category:r.FileCategory.PDF,label:s._("PDFs"),tooltip:s._("PDF"),icon:"pdf-small"},{category:r.FileCategory.SPREADSHEET,label:s._("Spreadsheets"),tooltip:s._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"numbers-small"},{category:r.FileCategory.PRESENTATION,label:s._("Presentations"),tooltip:s._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"keynote-small"},{category:r.FileCategory.AUDIO,label:s._("Audio"),tooltip:s._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},{category:r.FileCategory.VIDEO,label:s._("Video"),tooltip:s._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},{category:r.FileCategory.FOLDER,label:s._("Folders"),tooltip:s._("Dropbox folders"),icon:"folder-small"},{category:r.FileCategory.PAPER,label:s._("Paper docs"),tooltip:s._("Dropbox Paper docs"),icon:"paper-small"},{category:r.FileCategory.OTHER,label:s._("Other"),tooltip:s._("Other file types"),icon:"unknown-small"}],t.FILE_CATEGORIES_NO_PAPER=t.FILE_CATEGORIES_PAPER.filter((function(e){return e.category!==r.FileCategory.PAPER}))})),define("modules/clean/search/single_page/input/wrapper",["require","exports","tslib","react-redux","react","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/react/css","modules/clean/react/retrieval_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/single_page/constants","modules/clean/search/single_page/input/component","modules/clean/search/single_page/navigation","modules/clean/web_timing_logger","modules/clean/web_user_action_events"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),n=r.__importStar(n);var m=new o.UserApiV2Client,f=(function(t){function o(o){var n=t.call(this,o)||this;return n.loadConnectedInput=function(){return r.__awaiter(n,void 0,void 0,(function(){var t,o,n,i,p,d,f,S,g,y,v,E,R,C,w,b,I,P,x,T,A,B,O,H,D,L,F,M,q,N,U,Q=this;return r.__generator(this,(function(k){switch(k.label){case 0:return[4,Promise.all([new Promise((function(t,r){e(["modules/clean/search/single_page/input/connected"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/input/suggestions"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/store"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/action_creators"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/selectors/experiments"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/data/selectors/index"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/utils"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/logger"],t,r)})).then(r.__importStar),new Promise((function(t,r){e(["modules/clean/search/single_page/dropdown"],t,r)})).then(r.__importStar),m.ns("search").rpc("get_experiment_data",void 0,{subjectUserId:this.props.user.id})])];case 1:return t=k.sent(),o=t[0].ConnectedSearchInput,n=t[1].ConnectedSearchSuggestions,i=t[2].getStoreForSearch,p=t[3],d=p.clear,f=p.setVariant,S=p.setQuery,g=p.setUser,y=p.setPath,v=p.updateFromUrl,E=p.setExperiments,R=p.setSessionId,C=p.fetchPeopleSuggestions,w=p.fetchQuerySuggestions,b=t[4],I=b.searchBarExperiments,P=b.isInPeopleFilterExperiment,x=t[5].sessionId,T=t[6],A=T.generateRandomId,B=T.navigateToResult,O=t[7],H=O.logSearchBoxFocus,D=O.logNavigateToResult,L=t[8].SearchDropdown,F=t[9],M=F.user_options,q=F.experiments,(N=i()).dispatch(f({variant:this.props.variant})),N.dispatch(g({user:this.props.user,options:M})),void 0!==this.props.path&&N.dispatch(y({path:this.props.path})),N.dispatch(E({experiments:q})),P(N.getState())&&N.dispatch(C({user:this.props.user,query:""})),"full-page"===this.props.variant&&(h.searchNavigationManager.removeListener("update",this.handleUrlUpdate),h.searchNavigationManager.removeListener("exit",this.handleUrlExit),h.searchNavigationManager.addListener("update",(function(e){e.query&&!Q.props.isActive&&Q.props.onSearchEnter&&Q.props.onSearchEnter(),N.dispatch(v(e))})),h.searchNavigationManager.addListener("exit",(function(){l.isInSearchSuccessBannerExperiment(I(N.getState()))&&c.setSearchSuccessBannerVisible(),Q.props.onSearchExit&&Q.props.onSearchExit(),N.dispatch(d())})),h.searchNavigationManager.load()),x(N.getState())||N.dispatch(R({sessionId:A()})),this.state.query&&N.dispatch(S({query:this.state.query})),l.isInPriorQuerySuggestionsExperiment(I(N.getState()))&&N.dispatch(w({query:"",maxResults:u.SEARCH_PRIOR_QUERY_SUGGESTIONS_CAPACITY,variant:I(N.getState()).expQuerySuggestions||void 0})),this.handleSearchEnter=function(){H(),Q.props.onSearchEnter&&Q.props.onSearchEnter()},U=function(e,t,r){B(e,t,r),D(r,e,_.ActionSurfaceLogValue.TOP_NAVIGATION,_.ActionSourceValue.KEYBOARD)},this.renderInput=function(){return a.createElement(s.Provider,{store:N},a.createElement(a.Fragment,null,a.createElement(o,r.__assign({},Q.props,{autoFocus:Q.state.hasFocus,onInputBlur:Q.handleInputBlur,onSearchEnter:Q.handleSearchEnter,navigateToResult:U})),a.createElement(n,{onFocusInput:Q.handleFocusInput}),"dropdown"===Q.props.variant&&a.createElement(L,{inputBox:Q.props.inputBoxRef})))},[2]}}))}))},n.handleInputBlur=function(){n.setState({hasFocus:!1})},n.handleFocusInput=function(){n.setState({hasFocus:!0})},n.handleUrlUpdate=function(e){e.query&&(n.props.isActive||n.handleSearchEnter(),n.handleSetQuery({query:e.query}))},n.handleUrlExit=function(){n.handleSearchExit()},n.handleSearchEnter=function(){n.setState({hasFocus:!0}),n.props.onSearchEnter&&n.props.onSearchEnter()},n.handleSearchExit=function(){n.handleSetQuery({query:""}),n.props.onSearchExit&&n.props.onSearchExit()},n.handleSetQuery=function(e){var t=e.query;n.setState({query:t}),d.get_timer("single_page_search").restart()},n.handleSetPath=function(e){var t=e.path;n.setState({path:t})},n.handleClear=function(){n.setState({query:"",path:""})},n.state={hasReduxStoreLoaded:!1,hasFocus:!1,query:"",path:o.path||"",querySuggestions:void 0,highlightedRow:-1,filteredContact:void 0,peopleSuggestions:void 0},n}return r.__extends(o,t),o.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return"full-page"===this.props.variant&&(h.searchNavigationManager.init(this.props.user),h.searchNavigationManager.addListener("update",this.handleUrlUpdate),h.searchNavigationManager.addListener("exit",this.handleUrlExit),h.searchNavigationManager.load()),0===document.location.pathname.indexOf("/search")?[3,2]:[4,d.waitForTTI()];case 1:e.sent(),e.label=2;case 2:return[4,this.loadConnectedInput()];case 3:return e.sent(),this.setState({hasReduxStoreLoaded:!0}),[2]}}))}))},o.prototype.componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,(function(){var s,a;return r.__generator(this,(function(o){switch(o.label){case 0:return!this.state.hasReduxStoreLoaded||this.props.isActive||n.paths_are_equal(t.path,this.props.path)||void 0===t.path?[3,3]:[4,new Promise((function(t,r){e(["modules/clean/search/single_page/data/store"],t,r)})).then(r.__importStar)];case 1:return s=o.sent().getStoreForSearch,[4,new Promise((function(t,r){e(["modules/clean/search/single_page/data/action_creators"],t,r)})).then(r.__importStar)];case 2:a=o.sent().setPath,s().dispatch(a({path:t.path,viewport:"input"})),o.label=3;case 3:return[2]}}))}))},o.prototype.render=function(){return this.state.hasReduxStoreLoaded?this.renderInput():a.createElement(p.SearchInputComponent,r.__assign({},this.props,this.state,{setQuery:this.handleSetQuery,setPath:this.handleSetPath,clear:this.handleClear,onSearchEnter:this.handleSearchEnter,onSearchExit:this.handleSearchExit}))},o})(a.Component);t.SearchInput=i.requireCssWithComponent(f,["/static/css/search/input-vflTkqoHy.css","/static/js/retrieval-components/index.web-vflIby6p0.css"])})),define("modules/clean/search/single_page/input/component",["require","exports","tslib","classnames","react","react-transition-group","spectrum/button","spectrum/icon_form","spectrum/icon_global","modules/clean/filepath","modules/clean/keycode","modules/clean/react/async/loadable","modules/clean/react/no-jquery","modules/clean/react/retrieval_success_banner/util","modules/clean/search/single_page/constants","modules/clean/search/single_page/navigation","modules/clean/search/store_helpers","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m,f,S,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),l=r.__importStar(l),g=r.__importStar(g);var v=p.Loadable({loader:function(){return S.waitForTTI().then((function(){return new Promise((function(t,r){e(["modules/clean/search/single_page/input/chips"],t,r)})).then(r.__importStar).then((function(e){return e.SearchChips}))}))},loading:a.createElement("span",{className:"search-chips"})}),E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hiddenButton=a.createRef(),t.hasEmptyQuery=function(){return!f.normalize(t.props.query)},t.handleChange=function(e){t.props.setQuery({query:e.target.value})},t.handleFocus=function(){t.props.onSearchEnter(),d.clearBrowseSuccessBannerCounter(),d.clearBrowseSuccessBannerKey(),d.clearBSBExtraData(),t.props.expSearchSuccessBanner&&d.resetSearchResultClickKey()},t.handleBlur=function(){t.hasSuggestions()||t.props.onInputBlur&&t.props.onInputBlur()},t.hasSuggestions=function(){return t.hasQuerySuggestions()||t.hasPeopleSuggestions()},t.hasQuerySuggestions=function(){return t.props.query.length>0&&t.props.querySuggestions&&t.props.querySuggestions.length},t.hasPeopleSuggestions=function(){return t.props.query.length>0&&t.props.peopleSuggestions&&t.props.peopleSuggestions.length},t.getNumOfSuggestions=function(){return t.getNumOfQuerySuggestions()+t.getNumOfPeopleSuggestions()},t.getNumOfQuerySuggestions=function(){return t.hasQuerySuggestions()?t.props.querySuggestions.length:0},t.getNumOfPeopleSuggestions=function(){return t.hasPeopleSuggestions()?t.props.peopleSuggestions.length:0},t.dismissSuggestions=function(){t.dimsissQuerySuggestions(),t.dismissPeopleSuggestions()},t.dimsissQuerySuggestions=function(){t.hasQuerySuggestions()&&t.props.dismissQuerySuggestions&&t.props.setHighlightedRow&&(t.props.dismissQuerySuggestions({query:t.props.query}),t.props.setHighlightedRow({index:void 0}))},t.dismissPeopleSuggestions=function(){t.hasPeopleSuggestions()&&t.props.dismissPeopleSuggestions&&t.props.dismissPeopleSuggestions({query:t.props.query})},t.onExitButtonClick=function(){t.handleSearchExit()},t.handleSearchExit=function(e){void 0===e&&(e=!0),t.props.expSearchSuccessBanner&&!d.userIsOptedOutOfRetrievalSuccessBanner()&&d.setSearchSuccessBannerVisible(),m.searchNavigationManager.exit(),t.props.onSearchExit(),t.input&&e&&t.input.blur(),t.hiddenButton.current&&e&&t.hiddenButton.current.focus()},t.handleEscape=function(){t.hasSuggestions()?t.dismissSuggestions():t.hasEmptyQuery()?t.handleSearchExit():(t.props.clear(),t.input&&t.input.focus())},t.handleKeyArrowDown=function(e){if(t.props.setHighlightedRow)if(e.preventDefault(),t.hasSuggestions()){var r=void 0===t.props.highlightedRow?0:Math.min(t.props.highlightedRow+1,t.getNumOfSuggestions()-1);t.props.setHighlightedRow({index:r})}else if(t.props.results&&!t.props.results.isEmpty()){r=void 0===t.props.highlightedRow?0:Math.min(t.props.highlightedRow+1,t.props.results.count());t.props.setHighlightedRow({index:r})}},t.handleKeyArrowUp=function(e){if(t.props.setHighlightedRow)if(e.preventDefault(),t.hasSuggestions()){var r=void 0===t.props.highlightedRow?t.getNumOfSuggestions()-1:Math.max(t.props.highlightedRow-1,0);t.props.setHighlightedRow({index:r})}else if(t.props.results&&!t.props.results.isEmpty()){r=void 0===t.props.highlightedRow?t.props.results.count()-1:Math.max(t.props.highlightedRow-1,0);t.props.setHighlightedRow({index:r})}},t.handleKeyEnter=function(e){if(t.props.highlightedRow&&e.preventDefault(),t.hasSuggestions()){if(t.dismissSuggestions(),void 0===t.props.highlightedRow)return;var r=t.getNumOfQuerySuggestions();if(t.props.highlightedRow<r){if(!(s=t.props.querySuggestions[t.props.highlightedRow]))return;t.props.setQuery({query:s.text,alwaysTriggerSearch:!0})}else{var s;if(!(s=t.props.peopleSuggestions[t.props.highlightedRow-r]))return;t.props.setFilteredAccountId({filteredAccountId:s.dbx_account_id}),t.props.setQuery({query:"",alwaysTriggerSearch:!0})}t.input&&t.input.focus()}else t.props.highlightedRow&&t.props.results&&!t.props.results.isEmpty()&&(0===t.props.highlightedRow?t.props.onSearch&&t.props.onSearch():t.props.results.has(t.props.highlightedRow-1)&&t.props.navigateToResult&&t.props.navigateToResult(t.props.results.get(t.props.highlightedRow-1),t.props.user,t.props.results))},t.handleKeyDown=function(e){switch(e.keyCode){case u.KeyCode.ESC:t.handleEscape();break;case u.KeyCode.DOWN:t.handleKeyArrowDown(e);break;case u.KeyCode.UP:t.handleKeyArrowUp(e);break;case u.KeyCode.ENTER:t.handleKeyEnter(e);break;case u.KeyCode.BACKSPACE:t.input&&0===t.input.selectionStart&&0===t.input.selectionEnd&&(t.props.filteredContact?t.props.setFilteredAccountId({filteredAccountId:void 0}):l.paths_are_equal(t.props.path,"/")||t.props.setPath({path:"/",viewport:"input"}));break;case u.KeyCode.TAB:e.shiftKey&&t.hasEmptyQuery()&&t.handleSearchExit(!1)}},t.handleSubmit=function(e){e.preventDefault(),t.props.onSearch&&t.props.onSearch()},t.handleDocumentClick=function(e){t.props.isActive&&e.srcElement&&(t.hasSuggestions()?h.closestElement(e.srcElement,".search__form")||t.dismissSuggestions():t.hasEmptyQuery()&&(h.closestElement(e.srcElement,".maestro-nav__container")||h.closestElement(e.srcElement,".pagelet-top-menu__container")||h.closestElement(e.srcElement,".maestro-header")&&!h.closestElement(e.srcElement,".search__form"))&&t.handleSearchExit())},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){document.addEventListener("click",this.handleDocumentClick,!1),this.props.autoFocus&&this.input&&(this.input.value="",this.input.focus(),this.input.value=this.props.query)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleDocumentClick,!1)},t.prototype.componentDidUpdate=function(e){var t=this;!this.props.isActive&&e.isActive&&this.input&&setTimeout((function(){return t.input.blur()}),5),this.props.autoFocus&&!e.autoFocus&&this.input&&this.input.focus()},Object.defineProperty(t.prototype,"input",{get:function(){return this.props.inputBoxRef&&this.props.inputBoxRef.current},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.isActive,r=e.query,u=e.filteredContact,p=e.path,h=u?y._("Add search terms to improve your results"):y._("Search"),d=u?y._("Search for content from “%(name)s”").format({name:u.name}):p?y._("Search in folder “%(folder)s”").format({folder:l.filename(p)}):y._("Search");return a.createElement("div",{className:s.default({search__form:!0,"search__form--is-active":t}),role:"combobox",key:"search__form-div","aria-expanded":t,"aria-haspopup":"listbox","aria-owns":"search__dropdown"},a.createElement("form",{onSubmit:this.handleSubmit,role:"search",key:"search__form"},a.createElement("span",{className:"search__icon",key:"search__icon"},a.createElement(c.IconGlobal,{name:"search-small","aria-hidden":!0})),a.createElement(v,{user:this.props.user,path:this.props.path,setPath:this.props.setPath,filteredContact:this.props.filteredContact,setFilteredAccountId:this.props.setFilteredAccountId}),a.createElement("input",{ref:this.props.inputBoxRef,key:"search__input","aria-label":d,className:s.default("search__input",{"search__input--ios":g.iOS}),maxLength:200,onChange:this.handleChange,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,placeholder:h,type:"text","aria-autocomplete":"list",value:r})),a.createElement(o.CSSTransition,{classNames:"search__exit-button",enter:!0,exit:!0,timeout:_.SEARCH_INPUT_ANIMATION_MS,in:t,unmountOnExit:!0},a.createElement(n.Button,{className:"search__exit-button",onClick:this.onExitButtonClick,"aria-label":y._("Exit search"),key:"search__exit",variant:"circular"},a.createElement(i.IconForm,{name:"cancel"}))),a.createElement("div",{tabIndex:-1,ref:this.hiddenButton}))},t.defaultProps={onSearchEnter:function(){},onSearchExit:function(){}},t})(a.PureComponent);t.SearchInputComponent=E})),define("modules/clean/search/single_page/navigation",["require","exports","tslib","eventemitter3","modules/clean/browse_uri_interface","modules/clean/query_string_helpers","modules/clean/search/single_page/constants","modules/core/browser","modules/core/i18n"],(function(e,t,r,s,a,o,n,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.DESKTOP_FROM_PATHS=["assistant","collab_browse"];var l=(function(e){function s(t,r){var s=e.call(this)||this;return s.lastHistoryMs=0,s.initialPath="",s.setSearchUrl=function(e,t){e!==s.document.location.pathname+s.document.location.search&&(s.returnTo||n.SEARCH_URL_REGEX.test(s.document.location.pathname)||(s.returnTo=s.document.location.pathname+s.document.location.search),t||s.shouldPushHistory()?s.window.history.pushState({},c._("Search results - Dropbox"),e):s.window.history.replaceState({},c._("Search results - Dropbox"),e),s.lastHistoryMs=(new Date).getTime(),s.previousTitle||(s.previousTitle=s.document.title,s.document.title=c._("Search results - Dropbox")))},s.setNonSearchUrl=function(e){s.shouldRedirect(e)?i.redirect(e):(s.window.history.pushState({},s.previousTitle||"",e),s.previousTitle&&(s.document.title=s.previousTitle,s.previousTitle=void 0),s.emit("exit"))},s.handlePopState=function(){n.SEARCH_URL_REGEX.test(s.document.location.pathname)?(s.lastHistoryMs=(new Date).getTime(),s.emit("update",o.parseQueryString(s.document.location.search))):s.shouldRedirect(s.document.location.pathname)?i.reload():s.emit("exit")},s.shouldPushHistory=function(){return(new Date).getTime()-s.lastHistoryMs>=n.SEARCH_HISTORY_DELAY},s.shouldRedirect=function(e){return(!n.HOME_URL_REGEX.test(s.initialPath)||!n.HOME_URL_REGEX.test(e))&&(!n.BROWSE_URL_REGEX.test(s.initialPath)||!n.BROWSE_URL_REGEX.test(e))},s.document=t,s.window=r,s}return r.__extends(s,e),Object.defineProperty(s.prototype,"source",{get:function(){return n.HOME_URL_REGEX.test(this.initialPath)?"home":n.BROWSE_URL_REGEX.test(this.initialPath)?"browse":n.SEARCH_URL_REGEX.test(this.initialPath)?"search":null},enumerable:!0,configurable:!0}),s.prototype.init=function(e){this.user=e,this.initialPath=this.document.location.pathname,this.window.addEventListener("popstate",this.handlePopState)},s.prototype.load=function(){if(n.SEARCH_URL_REGEX.test(this.document.location.pathname)){this.emit("update",o.parseQueryString(this.document.location.search));var e=o.parseQueryString(this.document.location.search);e.search_from&&!n.SEARCH_URL_REGEX.test(e.search_from)&&-1===t.DESKTOP_FROM_PATHS.indexOf(e.search_from)&&(this.returnTo=e.search_from)}},s.prototype.set=function(e,t){e&&(n.SEARCH_URL_REGEX.test(e)?this.setSearchUrl(e,t):this.setNonSearchUrl(e))},s.prototype.exit=function(){n.SEARCH_URL_REGEX.test(this.document.location.pathname)&&(this.returnTo&&!n.SEARCH_URL_REGEX.test(this.returnTo)||(this.returnTo=a.get_browse_root(this.user)),this.set(this.returnTo),this.returnTo=void 0)},s})(s.default);t.SearchNavigationManager=l,t.searchNavigationManager=new l(document,window)})),define("modules/clean/react/maestro/layout/header",["require","exports","tslib","react","react-dom","modules/clean/react/maestro/layout/top_menu_container","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/maestro/responsive","classnames","modules/clean/user_education/react/user_education_effect","modules/clean/react/css"],(function(e,t,r,s,a,o,n,i,c,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),c=r.__importDefault(c);var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.useHeaderPortal,a=e.chromeClass,n=r.__rest(e,["useHeaderPortal","chromeClass"]),u=s.default.createElement("header",{className:"maestro-header page-header__shadow"},s.default.createElement(i.VerticallyFixedWrapper,{className:"page-header",responsive:this.props.responsive},s.default.createElement("div",{className:c.default("page-header__title",this.props.titleClass)},s.default.createElement(l.UserEducationEffect,{containerName:"PageletMaestroHeader",name:"Title",useSpan:!0},this.props.title)),s.default.createElement(o.TopMenuContainer,r.__assign({},n))));return t?s.default.createElement(h,{chromeClass:a},u):u},t.defaultProps={isSearchBarExpanded:!1},t})(s.default.Component);t.PageletMaestroHeaderWithoutCSS=p;t.MaestroHeaderTitle=function(e){var t=e.children;return s.default.createElement("h1",{className:"page-header__heading"},t)};t.MaestroHeaderLogo=function(){return s.default.createElement("a",{href:"/",className:"page-header__logo"},s.default.createElement(n.DropboxLogo,{alt:"Dropbox"}))};var h=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentWillMount=function(){if(this.portalEl=document.getElementById("maestro-header-portal"),!this.portalEl){var e=document.getElementById("pagelet-2");e&&(this.portalEl=document.createElement("div"),this.portalEl.setAttribute("id","maestro-header-portal"),e.parentNode.insertBefore(this.portalEl,e))}},t.prototype.render=function(){return this.portalEl?s.default.createElement(s.default.Fragment,null,s.default.createElement("div",{className:"maestro-header page-header__shadow"}),a.default.createPortal(s.default.createElement("div",{className:this.props.chromeClass},this.props.children),this.portalEl)):this.props.children},t})(s.default.Component);t.MaestroHeaderPortal=h;var d=u.requireCssWithComponent(p,["/static/css/maestro_layout-vflDOJuWd.css"]);t.PageletMaestroHeader=d})),define("modules/clean/react/maestro/layout/chrome",["require","exports","tslib","react","classnames","spectrum/match","modules/clean/react/maestro/layout/header","modules/clean/react/maestro/layout/secondary_sidebar","modules/clean/react/maestro/responsive"],(function(e,t,r,s,a,o,n,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a);var l=(function(e){function t(t){var a=e.call(this,t)||this;a.scrollableSidebarRef=s.default.createRef(),a.isPageResponsive=function(){return!(!document||!document.documentElement)&&document.documentElement.classList.contains(c.RESPONSIVE_CLASS)},a.handleSetup=function(){a.setState({setupComplete:!0})},a.handleMatchMedium=function(){!1===a.state.responsive.isMatchedMedium&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedMedium:!0})}}))},a.handleUnmatchMedium=function(){!0===a.state.responsive.isMatchedMedium&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedMedium:!1})}}))},a.handleMatchLarge=function(){!1===a.state.responsive.isMatchedLarge&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedLarge:!0})}}))},a.handleUnmatchLarge=function(){!0===a.state.responsive.isMatchedLarge&&a.setState((function(e){return{responsive:r.__assign(r.__assign({},e.responsive),{isMatchedLarge:!1})}}))};var o=a.isPageResponsive();return a.state={responsive:{isResponsive:o,isMatchedMedium:!o,isMatchedLarge:!o},setupComplete:!o},a}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.user,l=e.titleRegion,u=e.titleClass,p=e.chromeClass,h=e.embeddedAppRegion,d=e.actionSidebarRegion,_=e.searchBarProps,m=e.useHeaderPortal,f=e.scrollableSidebarRegion,S=e.useScrollableSidebar,g=this.state,y=g.setupComplete,v=g.responsive,E=f&&S;return s.default.createElement("div",{className:a.default(["maestro-chrome",p])},v.isResponsive&&s.default.createElement(o.Match,{media:c.BREAKPOINT_LARGE,onSetup:this.handleSetup,onMatch:this.handleMatchLarge,onUnmatch:this.handleUnmatchLarge}),v.isResponsive&&s.default.createElement(o.Match,{media:c.BREAKPOINT_MEDIUM,onSetup:this.handleSetup,onMatch:this.handleMatchMedium,onUnmatch:this.handleUnmatchMedium}),y&&s.default.createElement(n.PageletMaestroHeader,r.__assign({user:t,title:l,titleClass:u,chromeClass:p,responsive:v,useHeaderPortal:m},_||{})),y&&s.default.createElement("div",{className:"maestro-app"},s.default.createElement("div",{className:"maestro-app-content"},"function"==typeof h?h(v):h),d&&!E&&s.default.createElement("div",{className:"maestro-secondary-sidebar__shadow",role:"complementary","aria-label":"sidebar"},s.default.createElement(i.MaestroSecondarySidebar,{responsive:v},"function"==typeof d?d(v):d)),f&&E&&s.default.createElement("div",{className:"maestro-secondary-sidebar__shadow",role:"complementary"},s.default.createElement("div",{className:"maestro-secondary-sidebar scrollable-secondary-sidebar",ref:this.scrollableSidebarRef},"function"==typeof f?f(v,this.scrollableSidebarRef):f))))},t})(s.default.PureComponent);t.MaestroChrome=l})),define("modules/clean/react/maestro/responsive",["require","exports","tslib","react","spectrum/vertically_fixed"],(function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.RESPONSIVE_CLASS="maestro--responsive",t.BREAKPOINT_MEDIUM="(min-width: 736px)",t.BREAKPOINT_LARGE="(min-width: 1025px)";var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.responsive,o=r.__rest(e,["responsive"]),n=t&&t.isResponsive?"div":a.VerticallyFixed;return s.default.createElement(n,o)},t.displayName="VerticallyFixedWrapper",t})(s.default.Component);t.VerticallyFixedWrapper=o})),define("modules/clean/react/maestro/layout/secondary_sidebar",["require","exports","tslib","react","modules/clean/react/maestro/responsive"],(function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={},r}return r.__extends(t,e),t.prototype.render=function(){return s.default.createElement(a.VerticallyFixedWrapper,{responsive:this.props.responsive,className:"maestro-secondary-sidebar"},this.props.children)},t})((s=r.__importDefault(s)).default.Component);t.MaestroSecondarySidebar=o})),define("modules/clean/react/maestro/layout/top_menu_container",["require","exports","tslib","react","external/lodash","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/history","modules/clean/react/browse/models","modules/core/browser","modules/clean/search/search_bar/controller","modules/clean/search/search_bar/log_helper","modules/clean/search/search_helpers","modules/core/uri","modules/clean/web_user_action_events","modules/clean/search/constants","modules/clean/react/css","modules/clean/search/single_page/input/wrapper"],(function(e,t,r,s,a,o,n,i,c,l,u,p,h,d,_,m,f,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),n=r.__importStar(n),i=r.__importDefault(i),l=r.__importStar(l),h=r.__importStar(h);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSearch=function(e){var s=e.query,a=e.searchToken,o=e.searchSessionId,n=e.searchPath,c=e.qargs,u=t.props.user;s&&l.redirect(h.buildSearchURL({user:u,searchPath:n,normalizedQuery:s,searchSessionId:o,searchToken:a,qargs:r.__assign(r.__assign({},c),{search_from:i.default.deconstruct_url().path})}).toString())},t.onSlimSearchResultOpen=function(e){var r=t.props.user;if(e instanceof c.Paper||e instanceof c.PaperFolder)l.open_tab(e.url);else{var s=e;if(s.is_dir){var a=new d.URI({path:"/"+r.role+s.fq_path});l.open_tab(a.toString())}else{var o=s.fq_path.substring(1);a=new d.URI({path:"/"+r.role}).updateQuery({preview:o});l.open_tab(a.toString())}}},t.logSearchResultOpen=function(e){var r=t.props.user;e instanceof c.File?p.logDropdownSearchAction({result:e,user:r,action_type:e.is_dir?_.WebUserActionLogEvent.FOLDER_OPEN:_.WebUserActionLogEvent.FILE_VIEW,viewport:"top-menu-dropdown-view"}):(e instanceof c.Paper||e instanceof c.PaperFolder)&&p.logDropdownSearchAction({result:e,user:r,action_type:_.WebUserActionLogEvent.PAPER_OPEN,viewport:"top-menu-dropdown-view"})},t.onResultObjectPathClick=function(e){var r=t.props.user;p.logDropdownSearchAction({result:e,user:r,action_type:_.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"});var s=n.parent_dir(e.fq_path),a=o.browse_uri_for_fq_path(r,s||"").toString();l.open_tab(a)},t}return r.__extends(t,e),t.prototype.renderSearchBar=function(){if(this.props.user){if(this.props.overrideSearchBar)return this.props.overrideSearchBar;if("legacy"===this.props.searchVariant)return s.default.createElement(u.SearchBarController,{user:this.props.user,currentPath:this.props.currentPath,isExpanded:this.props.isSearchBarExpanded,onSearch:this.props.onSearch||this.onSearch,onSearchResultOpen:this.props.onSearchResultOpen||this.logSearchResultOpen,onSlimSearchResultOpen:this.props.onSearchResultOpen?void 0:this.onSlimSearchResultOpen,onResultObjectPathClick:this.props.onResultObjectPathClick||this.onResultObjectPathClick,searchBarExperiments:this.props.searchBarExperiments||{},onSearchFiltersChanged:this.props.onSearchFiltersChanged||a.noop,fileCategories:this.props.fileCategories||m.FILE_CATEGORIES_UNCHECKED,searchFrom:this.props.searchFrom});if("full-page"===this.props.searchVariant||"dropdown"===this.props.searchVariant)return s.default.createElement(S.SearchInput,{variant:this.props.searchVariant,user:this.props.user,path:this.props.currentPath,isActive:!!this.props.isSearching,onSearchEnter:this.props.onSearchEnter,onSearchExit:this.props.onSearchExit,inputBoxRef:this.props.inputBoxRef})}return null},t.prototype.renderRightContent=function(){return this.props.rightContent?this.props.rightContent:s.default.createElement("div",{className:"top-menu-container--search-bar-empty-space"})},t.prototype.render=function(){return s.default.createElement("div",{className:"top-menu-container "+this.props.classNames},this.renderSearchBar(),this.renderRightContent())},t.defaultProps={searchVariant:"legacy",isSearchBarExpanded:!1,classNames:"",currentPath:"/"},t})(s.default.Component);t.TopMenuContainer=f.requireCssWithComponent(g,["/static/css/pagelet-vflMzK4D8.css"],[u.SearchBarController])})),define("modules/clean/search/api_helpers",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTimezoneOffset=function(){return(new Date).getTimezoneOffset()}}));
//# sourceMappingURL=pkg-embedded_app_search.min.js-vfl3rYXrL.map