define(["require","exports","tslib","classnames","react","spectrum/button","spectrum/colorized_icon","spectrum/icon_action","spectrum/icon_content","spectrum/icon_global","spectrum/toggle","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filename_highlights","modules/clean/filepath","modules/clean/static_urls","modules/clean/paper_formatting_utils","modules/clean/react/browse/models","modules/clean/react/files_view/star","modules/clean/react/icon/file_folder_icon","modules/clean/react/image","modules/clean/react/title_bubble","modules/clean/react_format","modules/clean/search/constants","modules/clean/search/logger","modules/clean/search/models","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/preview","modules/clean/search/search_bar/query_suggestions_table","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/react/retrieval_success_banner/util","modules/core/browser","modules/core/i18n","modules/core/accessible_announce","spectrum/file_icon"],(function(e,t,r,o,a,n,s,i,l,c,u,p,h,d,_,m,f,g,w,y,b,E,S,C,v,x,D,H,M,R,O,k,I,P,T,N,B){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),a=r.__importDefault(a),d=r.__importStar(d),_=r.__importStar(_),f=r.__importStar(f),v=r.__importStar(v),D=r.__importStar(D),k=r.__importStar(k),P=r.__importStar(P);var F=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._announceLoading=function(){N.AccessibleAnnounce.polite(T._("Loading search…"))},t._ignoreMouseDown=function(e){e.stopPropagation(),e.preventDefault()},t._onClearAllHistoryMouseDown=function(e){e.stopPropagation(),e.preventDefault(),t.props.onHistoryClearAllClick&&k.shouldHandleClick(e)&&t.props.onHistoryClearAllClick()},t._renderHistoryHeader=function(){var e=T._("RECENT SEARCHES"),r=T._("CLEAR ALL");return a.default.createElement(W,{className:"search-bar__history-header search-bar__dropdown-item--border-top",id:"search-dropdown-history-header",onMouseDown:t._ignoreMouseDown,"aria-label":e,"aria-selected":!1},a.default.createElement("div",null,e),a.default.createElement(n.Button,{tagName:"a",variant:"styleless",onClick:t._onClearAllHistoryMouseDown},r))},t._renderEmptyState=function(){return a.default.createElement("div",{className:"u-font-center u-pad-top-xl"},a.default.createElement(b.Image,{src:m.static_url("/static/images/empty_states/search-vflHMNVT9.png"),srcHiRes:m.static_url("/static/images/empty_states/search@2x-vfly2B3kk.png"),alt:"",width:200,height:200}),a.default.createElement("h2",{className:"u-font-strong empty-folder-table-title"},T._("Begin typing to search")),a.default.createElement("span",null,T._("Search for files, folders, and content")))},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.searchBarLoading&&this._announceLoading(),this._shouldShowRecentHistory(this.props)&&v.logRecentHistoryDisplayed({searchSessionId:this.props.searchSessionId,user:this.props.user,history:this.props.searchHistory})},t.prototype.componentWillReceiveProps=function(e){this._willShowRecentHistoryOnPropsChange(e)&&v.logRecentHistoryDisplayed({searchSessionId:e.searchSessionId,user:e.user,history:e.searchHistory})},t.prototype.componentDidUpdate=function(e){var t=this.props,r=t.searchBarLoading,o=t.normalizedQuery,a=t.searchResults,n=t.onDropdownTTI;r&&!e.searchBarLoading&&this._announceLoading(),o&&e.searchBarLoading&&!r&&(N.AccessibleAnnounce.polite(T.ungettext("Found %(num)s search result","Found %(num)s search results",a.length).format({num:a.length})),n&&n())},t.prototype._shouldShowRecentHistory=function(e){return e.isOpen&&!e.normalizedQuery&&e.searchHistory.length>0},t.prototype._shouldShowEmptyState=function(){var e=this.props,t=e.isOpen,r=e.normalizedQuery,o=e.searchHistory,a=e.searchBarExperiments;return t&&!r&&H.isInSinglePageSearchExperiment(a)&&0===o.length},t.prototype._shouldShowPosteriorQuerySuggestions=function(e){var t=e.isOpen,r=e.normalizedQuery,o=e.areQuerySuggestionsLoaded;return t&&!!r&&!!o},t.prototype._willShowRecentHistoryOnPropsChange=function(e){return this._shouldShowRecentHistory(e)&&(this.props.normalizedQuery!==e.normalizedQuery||0===this.props.searchHistory.length&&e.searchHistory.length>0||!this.props.isOpen&&e.isOpen)},t.prototype._renderPosteriorQuerySuggestions=function(){var e=this.props,t=e.querySuggestions,r=e.onQuerySuggestionsClick,o=e.highlightedRow,n=e.onHighlightDropdownItem;if(t&&r){return a.default.createElement(R.QuerySuggestionsTable,{querySuggestions:t,onQuerySuggestionsClick:r,indexOffset:1,highlightedRow:o,onHighlightDropdownItem:n})}return null},t.prototype.renderScopeChipDropdown=function(e){var t=this.props,r=t.searchBarExperiments,o=t.highlightedRow,n=t.onHighlightDropdownItem,s=t.browseScope,i=t.scopeChip,l=t.onSearchChipInteraction,c=_.child_dir(s),u=h.Emstring.em_snippet(c,16,.6),p=S.reactFormat(T._("Filter to <strong>%(folder_name)s</strong>"),{folder_name:u,strong:a.default.createElement("strong",{key:"title"})}),d=a.default.createElement("span",null,p),m=u!==c;return a.default.createElement(L,{row:e,searchBarExperiments:r,highlightedRow:o,onHighlightDropdownItem:n,isOn:D.isValidPathForChip(i),text:d,tooltip:m?c:void 0,onInteraction:l,className:"search-bar__dropdown_chip-toggle--scope"})},t.prototype.render=function(){var e,t=[],n=this._shouldShowRecentHistory(this.props),s=this.props.dropdownHeaderItems,i=s.length,l=O.SearchBarDropdownHeaderItemType.SEARCH_ALL,c=this.props.showLinkToResultsPage&&!n&&-1!==s.indexOf(l),u=O.SearchBarDropdownHeaderItemType.SCOPE_CHIPS,p=this.props.scopeChip&&-1!==s.indexOf(u),h=this.props,d={highlightedRow:h.highlightedRow,onHighlightDropdownItem:h.onHighlightDropdownItem,searchPath:h.searchPath,searchSessionId:h.searchSessionId,user:h.user};if(n)for(var _=0;_<this.props.searchHistory.length;_++){var m=this.props.searchHistory[_];t.push(a.default.createElement(U,r.__assign({},d,{indexOffset:i,key:m.rawQuery,onClick:this.props.onHistoryItemClick,onContextMenuCapture:this.props.onRecentSearchContextMenuCapture,query:m,row:_+i})))}else{var f=Math.min(C.MaxResults.MAX_SEARCH_SUGGESTIONS,this.props.searchResults.length);for(_=0;_<f;_++){var w=this.props.searchResults[_],y=r.__assign(r.__assign({},this.props),{row:_+i,indexOffset:i,resultCount:f});w instanceof x.SlimFileSearchResult||w instanceof g.File?t.push(a.default.createElement(z,r.__assign({},y,{resultObject:w,key:w.fq_path}))):w instanceof g.Paper?t.push(a.default.createElement(q,r.__assign({},y,{resultObject:w,key:w.pad_id}))):w instanceof g.PaperFolder?t.push(a.default.createElement(j,r.__assign({},y,{resultObject:w,key:w.folder_id}))):w instanceof g.FileSharedWithMe&&t.push(a.default.createElement(A,r.__assign({},y,{resultObject:w,key:w.file_id})))}}var b,E=((e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen})[this.props.className||""]=!0,e);b="function"==typeof this.props.children?this.props.children():a.default.createElement("noscript",null);var S=this._shouldShowPosteriorQuerySuggestions(this.props);return a.default.createElement("div",{className:o.default(E),"aria-hidden":!this.props.isOpen},a.default.createElement("ol",{className:o.default({"search-bar__dropdown-items":!0}),id:"search-bar__dropdown-items",role:"listbox","aria-label":T._("search dropdown")},c&&a.default.createElement(Q,r.__assign({},this.props)),p&&this.renderScopeChipDropdown(s.indexOf(u)),S&&this._renderPosteriorQuerySuggestions(),n&&this._renderHistoryHeader(),this._shouldShowEmptyState()&&this._renderEmptyState(),t,b),this.props.searchBarLoading&&a.default.createElement("div",{className:"search-bar__loading"},a.default.createElement("span",{className:"ax-visually-hidden"},T._("Loading search..."))))},t.defaultProps={showLinkToResultsPage:!0},t})(a.default.Component);t.SearchBarDropdown=F;var L=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseEnter=function(){return t.props.onHighlightDropdownItem(t.props.row)},t._onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),k.shouldHandleClick(e)&&t.props.onInteraction&&t.props.onInteraction(!t.props.isOn)},t._onToggleClick=function(e){e.stopPropagation(),e.preventDefault()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.row,r=e.highlightedRow,n=e.isOn,l=e.text,c=e.tooltip,p=e.className,h=this.props.row===r,d={"search-bar__dropdown-item":!0,"search-bar__dropdown-item--border-top":!0,"search-bar__full_search_suggestion":!0,"search-bar__dropdown_chip-toggle":!0,"search-bar__dropdown-item--is-highlighted":h};p&&(d[p]=!0);var _=n?T._("On"):T._("Off"),m=T._("%(header_text)s: %(toggle_description)s",{comment:"format string for aria label for the search bar chip toggle"}).format({header_text:l,toggle_description:_});return a.default.createElement(W,{id:"search-dropdown-item"+t,className:o.default(d),onMouseEnter:this._onMouseEnter,onMouseDown:this._onMouseDown,"aria-selected":h,"aria-label":m},a.default.createElement("div",{className:"mc-media-cell-icon search-bar__dropdown-item-cell-icon"},a.default.createElement(s.ColorizedIcon,{color:"#6A7C8F"},a.default.createElement(i.IconAction,{name:"sort",className:"search-bar__chip-icon--sort"}))),a.default.createElement("div",{className:"search-bar__header-text"},c?a.default.createElement(E.TitleBubble,{content:c,position:E.TitleBubble.POSITIONS.BOTTOM},l):l),a.default.createElement("div",{className:"search-bar__chip_toggle"},a.default.createElement(u.Toggle,{onClick:this._onToggleClick,interactive:!1,labelContent:_,ariaLabel:_,checked:n})))},t})(a.default.Component),Q=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderTitle=function(){var e=t.props.searchPath;return _.paths_are_equal(e,"/")?S.reactFormat(T._("View all results for “%(query)s”"),{query:t.props.normalizedQuery,strong:a.default.createElement("strong",{key:"title"})}):S.reactFormat(T._("View all results for <span>“%(query)s”</span> in <strong>%(current_path)s</strong>"),{current_path:_.filename(e),query:t.props.normalizedQuery,span:a.default.createElement("span",{key:"title"}),strong:a.default.createElement("strong",{key:"path"})})},t._renderTitleText=function(){var e=t.props.searchPath;return _.paths_are_equal(e,"/")?T._("View all results for “%(query)s”").format({query:t.props.normalizedQuery}):T._("View all results for “%(query)s” in %(current_path)s").format({query:t.props.normalizedQuery,current_path:_.filename(e)})},t._onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),k.shouldHandleClick(e)&&t.props.onSearch(t.props.normalizedQuery)},t._onMouseEnter=function(){return t.props.onHighlightDropdownItem(0)},t}return r.__extends(t,e),t.prototype.render=function(){var e=0===this.props.highlightedRow,t={"search-bar__dropdown-item":!0,"search-bar__dropdown-item--border-top":!0,"search-bar__dropdown-item--header":!0,"search-bar__dropdown-item--is-highlighted":e,"search-bar__full_search_suggestion":!0,"js-search-bar__view-all-results":!0};return a.default.createElement(W,{className:o.default(t),id:"search-dropdown-item0",onMouseDown:this._onMouseDown,onMouseEnter:this._onMouseEnter,"aria-selected":e,"aria-label":this._renderTitleText()},a.default.createElement("div",{className:"mc-media-cell-icon search-bar__dropdown-item-cell-icon"},a.default.createElement(s.ColorizedIcon,{color:"#6A7C8F"},a.default.createElement(c.IconGlobal,{name:"search-small",className:"search-bar__dropdown-item-icon--search"}))),a.default.createElement("div",{className:"search-bar__header-text"},this._renderTitle()))},t})(a.default.Component),q=(function(e){function t(t){var r=e.call(this,t)||this;return r.state=r._calcState(t),r}return r.__extends(t,e),t.prototype._calcState=function(e){return{titleParts:f.getPaperDocTitleParts(e.resultObject,"search-bar__dropdown-item-icon","search-bar__dropdown-item-icon-emoji")}},t.prototype.componentWillReceiveProps=function(e){if(this.props.resultObject.title!==e.resultObject.title){var t=this._calcState(e);this.setState(t)}},t.prototype.render=function(){var e=this.state.titleParts,t=e.highlightedTitle,o=e.title,n=e.icon;return a.default.createElement(G,r.__assign({},this.props,{icon:n,title:t,ariaTitle:o,location:"Paper"}))},t})(a.default.Component),j=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.resultObject,t=a.default.createElement(l.IconContent,{name:"folder-small",className:"search-bar__dropdown-item-icon"}),o=e.highlight_spans&&e.highlight_spans.length>0?d.highlightReactFromHighlightSpans(e.name,e.highlight_spans):a.default.createElement("span",null,e.name);return a.default.createElement(G,r.__assign({},this.props,{icon:t,title:o,ariaTitle:e.name,location:"Paper"}))},t})(a.default.Component),A=function(e){var t=e.resultObject,o=a.default.createElement(B.FileIcon,{path:t.filename}),n=t.highlight_spans&&t.highlight_spans.length>0?d.highlightReactFromHighlightSpans(t.filename,t.highlight_spans):a.default.createElement("span",null,t.filename);return a.default.createElement(G,r.__assign({},e,{icon:o,title:n,ariaTitle:t.filename,location:T._("Shared with you")}))},z=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.resultObject,t=_.filename(e.fq_path),o=_.parent_dir(e.fq_path),n="Dropbox",s=o.split("/");s.shift(),e.is_unmounted&&s.length>0&&(n=s.shift());var i=s[s.length-1];s.length>=2&&(n+="/..."),i&&i.length&&(n+="/"+i);var l,c=r.__assign({isDeleted:e.is_unmounted},e);return l=e.highlight_spans?d.highlightReactFromHighlightSpans(t,e.highlight_spans):d.highlightMatchReact(t,e.filename_highlights),a.default.createElement(G,r.__assign({},this.props,{icon:a.default.createElement(y.FileOrFolderIcon,{className:"search-bar__dropdown-item-icon",file:c}),title:l,ariaTitle:t,location:n,isUnmounted:e.is_unmounted,parentFolderUrl:p.browse_uri_for_fq_path(this.props.user,o).toString()}))},t})(a.default.Component);function U(e){var t=e.query,o=e.searchPath,n=e.searchSessionId,i=e.user,l=T._("Search for %(query)s").format({query:t.rawQuery}),u=a.default.createElement("div",{className:"mc-media-cell-icon search-bar__dropdown-item-cell-icon"},a.default.createElement(s.ColorizedIcon,{color:"#6A7C8F"},a.default.createElement(c.IconGlobal,{name:"search-small",className:"search-bar__recent_search-icon--search"}))),p=k.buildSearchURL({user:i,searchPath:o,normalizedQuery:t.normalizedQuery,searchSessionId:n,searchToken:k.getSearchCsrfToken()}).toString(),h=V;return a.default.createElement(h,r.__assign({},e,{data:t,titleText:t.rawQuery,ariaLabel:l,classes:{"search-bar__recent_search":!0},icon:u,href:p,noTopBorder:!0}))}var V=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClick&&k.shouldHandleClick(e)&&t.props.onClick(t.props.data,t.props.row)},t._onContextMenuCapture=function(){t.props.onContextMenuCapture&&t.props.onContextMenuCapture(t.props.data,t.props.row)},t._onMouseEnter=function(){return t.props.onHighlightDropdownItem(t.props.row)},t}return r.__extends(t,e),t._onClick=function(e){k.shouldHandleClick(e)&&(e.stopPropagation(),e.preventDefault())},t.prototype.render=function(){var e=this.props,n=e.ariaLabel,s=e.highlightRanges,i=e.highlightedRow,l=e.href,c=e.icon,u=e.indexOffset,p=e.noTopBorder,h=e.row,_=e.titleText,m=h===i,f=d.highlightReactFromHighlightSpans(_,s),g=h-u,w=r.__assign(r.__assign({},this.props.classes),{"search-bar__dropdown-item--is-highlighted":m,"search-bar__dropdown-item--border-top":!p&&0===g});return a.default.createElement(W,{className:o.default(w),id:"search-dropdown-item"+h,onMouseDown:this._onMouseDown,onMouseEnter:this._onMouseEnter,onClick:t._onClick,"aria-selected":m,"aria-label":n},c,a.default.createElement("a",{href:l,onContextMenuCapture:this._onContextMenuCapture},a.default.createElement("div",{className:"search-bar__row-name"},f)))},t.defaultProps={noTopBorder:!1},t})(a.default.Component),G=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseDown=function(e){e.stopPropagation(),e.preventDefault(),k.shouldHandleClick(e)&&t.props.onSearchResultOpen(t.props.resultObject)},t._onPathLinkClick=function(e){var r=t.props.searchBarExperiments;e.stopPropagation(),e.preventDefault(),r.expSearchSuccessBanner&&"/h"===P.get_pathname()&&I.setSearchSuccessBannerVisibleFromHome(),k.shouldHandleClick(e)&&t.props.onResultObjectPathClick(t.props.resultObject)},t._onMouseEnter=function(){return t.props.onHighlightDropdownItem(t.props.row)},t._onContextMenuCapture=function(){var e=t.props,r=e.onContextMenuCapture,o=e.resultObject;r&&r(o)},t._getSearchBarDropdownResultVariant=function(){var e,r=t.props,o=r.isUnmounted,n=r.location,s=r.resultObject,i=r.user,l=r.title,c=r.parentFolderUrl;e=o?S.reactFormat(T._("not added yet, in <locationSpan>%(location)s</locationSpan>",{comment:"Describes the mountable directory of a file in a list of search results."}),{location:n,locationSpan:a.default.createElement("span",{key:"location",title:n})}):S.reactFormat(T._("<locationSpan>in %(location)s</locationSpan>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:n,locationSpan:a.default.createElement("span",{key:"location",title:n})});var u=k.resultObjectToUrl(s,i),p=a.default.createElement(w.StarContainer,{item:s,user:i,key:"dropdownStar",className:"search-bar__search-result-star",isReadOnly:!0});return a.default.createElement("div",null,a.default.createElement(M.SearchBarDropdownPreview,{result:s,visible:t.props.row===t.props.highlightedRow,user:i,searchSessionId:t.props.searchSessionId,position:t.ref?window.innerHeight-t.ref.getBoundingClientRect().bottom:void 0}),a.default.createElement("a",{href:u,onContextMenuCapture:t._onContextMenuCapture},a.default.createElement("div",{className:"search-bar__search-result-name-star-group"},a.default.createElement("div",{className:"search-bar__search-result-name"},l),p)),a.default.createElement("div",{className:"search-bar__search-result-desc"},c?a.default.createElement("a",{href:c,onMouseDown:t._onPathLinkClick,onContextMenuCapture:t._onContextMenuCapture,className:"search-bar__search-result-desc-link"},e):a.default.createElement("span",null,e)))},t.setRef=function(e){t.ref=e},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.highlightedRow,r=e.indexOffset,n=e.row,s=e.resultCount,i=e.icon,l=e.ariaTitle,c=e.location,u=n===t,p=n-r,h={"search-bar__dropdown-item":!0,"search-bar__result":!0,"search-bar__dropdown-item--is-highlighted":u,"search-bar__dropdown-item--border-top":0===p},d=T._("Search Result %(index)s of %(result)s: %(aria_title)s in %(location)s").format({index:p+1,result:s,aria_title:l,location:c});return a.default.createElement(W,{className:o.default(h),id:"search-dropdown-item"+n,onMouseDown:this._onMouseDown,onMouseEnter:this._onMouseEnter,"aria-selected":u,_ref:this.setRef,"aria-label":d},a.default.createElement("div",{className:"mc-media-cell-icon search-bar__dropdown-item-cell-icon"},i),this._getSearchBarDropdownResultVariant())},t})(a.default.Component),W=function(e){var t=e._ref,o=r.__rest(e,["_ref"]);return a.default.createElement("li",r.__assign({role:"option","aria-label":e["aria-label"],"aria-selected":e["aria-selected"],tabIndex:0,ref:t},o))}}));
//# sourceMappingURL=dropdown.min.js-vflqaONSR.map